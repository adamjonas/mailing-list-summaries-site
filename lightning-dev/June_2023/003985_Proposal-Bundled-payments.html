<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=us-ascii">
    <title>Atom Feed Display</title>
    <link rel="stylesheet" href="../../archive_styles.css">
</head>

<body BGCOLOR="#fffffb">
    
    <h1>Proposal: Bundled payments</h1>
    <hr class="solid">
    
    <ul>
        
        
            <p><b>Author:</b> David A. Harding 2023-06-19 20:29:34+00:00
            <br><i>Published on: 2023-06-19T20:29:34+00:00</i></p>

        
        

        
        
        <li>
        <a href="/lightning-dev/June_2023/combined_Proposal-Bundled-payments.html"> Combined Summary of all posts in thread </a>
        </li>
        
        <li>
            
                <a href="https://lists.linuxfoundation.org/pipermail/lightning-dev/2023-June/003985.html">Click here to read original discussion on the lightning-dev mailing list</a>
            
        </li>

    </ul>

    <hr>
    <h3> Summary:</h3>
    <p>In an email exchange between Thomas Voegtlin and Dave, the semantics of bundled payments are discussed. According to Thomas, a BOLT-11 invoice should contain two preimages and two amounts: prepayment and main payment. The receiver is required to wait until all the HTLCs (Hashed Time-Locked Contracts) of both payments have arrived before fulfilling the HTLCs of the pre-payment. If the main payment does not arrive, the receiver should fail the pre-payment with a MPP (Multi-Path Payments) timeout. Once the HTLCs of both payments have arrived, the receiver fulfills the HTLCs of the prepayment and broadcasts their on-chain transaction. However, it is mentioned that the main payment can still fail if the sender never reveals the preimage of the main payment.Dave raises a question regarding the requirement of a payment hash for the prepayment in a BOLT11 invoice. He suggests using a keysend payment with the onion message payload to indicate the payment hash to associate with the prepayment. For example, Alice wants to receive 1 BTC with a prepayment of 10k sats and the payment hash of 0123...cdef. In this case, the 10k sats would be sent via keysend with metadata indicating that the receiver shouldn't claim it until they receive the 1 BTC HTLC to 0123...cdef.Dave proposes extending BOLT11 invoices with an extra_fee_via_keysend field, which would be smaller and allow encoding this field in an existing BOLT11 field like description or metadata. This approach could enable immediate implementation until an updated version of BOLT11 or an alternative using offers becomes widely deployed.Overall, the discussion revolves around the semantics of bundled payments and the possibility of using keysend payments instead of payment hashes in BOLT11 invoices.</p>
    <hr>
    <p><i> Updated on: 2023-06-29T02:55:45.262213+00:00 </i></p>
    
    

    <footer>
        <span style="font-family: Arial, Helvetica, sans-serif;">&#10084;&#65039;</span> <a href="https://chaincode.com" target="_blank" rel="noreferrer" style="text-decoration: none; color: inherit;">Chaincode</a>
    </footer>
</body>

</html>