<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=us-ascii">
    <title>Atom Feed Display</title>
    <link rel="stylesheet" href="../../archive_styles.css">
</head>

<body BGCOLOR="#fffffb">
    
    <h1>Proposal: Bundled payments</h1>
    <hr class="solid">
    
    <ul>
        
        
            <p><b>Author:</b> David A. Harding 2023-06-19 20:29:34+00:00
            <br><i>Published on: 2023-06-19T20:29:34+00:00</i></p>

        
        

        
        
        <li>
        <a href="/lightning-dev/June_2023/combined_Proposal-Bundled-payments.html"> Combined Summary of all posts in thread </a>
        </li>
        
        <li>
            
                <a href="https://lists.linuxfoundation.org/pipermail/lightning-dev/2023-June/003985.html">Click here to read original discussion on the lightning-dev mailing list</a>
            
        </li>

    </ul>

    <hr>
    <h3> Summary:</h3>
    <p>In a recent email exchange between Thomas Voegtlin and Dave, they discussed the semantics of bundled payments. Thomas explained that in the BOLT-11 invoice, there are two preimages and two amounts: a prepayment and a main payment. The receiver is expected to wait until all the HTLCs (Hash Timelock Contracts) of both payments have arrived before fulfilling the HTLCs of the pre-payment. If the main payment does not arrive, the receiver should fail the pre-payment with a MPP (Multi-Path Payments) timeout. Once the HTLCs of both payments have arrived, the receiver can fulfill the HTLCs of the prepayment and broadcast their on-chain transaction. However, it's important to note that the main payment can still fail if the sender never reveals the preimage of the main payment.Dave then proposed an alternative approach for the prepayment by using a keysend payment with the onion message payload. This would allow the receiver to indicate what payment hash to associate with the prepayment. For example, Alice wants to receive 1 BTC with a specific payment hash, and she also has a prepayment of 10k sats. Instead of including the payment hash in the BOLT11 invoice, the 10k sats can be sent via keysend with metadata indicating that the receiver shouldn't claim it until they receive the 1 BTC HTLC associated with the specified payment hash.Dave suggested extending the BOLT11 invoices with an extra_fee_via_keysend field to accommodate this alternative approach. This would make the invoices significantly smaller and provide the ability to encode the extra_fee_via_keysend field in existing BOLT11 fields like the description or metadata field. Implementing this extension could be done immediately until a new version of BOLT11 or an alternative using offers becomes widely deployed.The email exchange highlights the discussion around the semantics of bundled payments and explores a potential alternative approach using keysend payments with metadata.</p>
    <hr>
    <p><i> Updated on: 2023-07-06T03:00:23.512893+00:00 </i></p>
    
    

    <footer>
        <span style="font-family: Arial, Helvetica, sans-serif;">&#10084;&#65039;</span> <a href="https://chaincode.com" target="_blank" rel="noreferrer" style="text-decoration: none; color: inherit;">Chaincode</a>
    </footer>
</body>

</html>