<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=us-ascii">
    <title>Atom Feed Display</title>
    <link rel="stylesheet" href="../../archive_styles.css">
</head>

<body BGCOLOR="#fffffb">
    
    <h1>Proposal: Bundled payments</h1>
    <hr class="solid">
    
    <ul>
        
        
            <p><b>Author:</b> David A. Harding 2023-06-19 20:29:34+00:00
            <br><i>Published on: 2023-06-19T20:29:34+00:00</i></p>

        
        

        
        
        <li>
        <a href="/lightning-dev/June_2023/combined_Proposal-Bundled-payments.html"> Combined Summary of all posts in thread </a>
        </li>
        
        <li>
            
                <a href="https://lists.linuxfoundation.org/pipermail/lightning-dev/2023-June/003985.html">Click here to read original discussion on the lightning-dev mailing list</a>
            
        </li>

    </ul>

    <hr>
    <h3> Summary:</h3>
    <p>In an email exchange between Thomas Voegtlin and Dave, they discuss the semantics of bundled payments in the context of BOLT-11 invoices. The BOLT-11 invoice is said to contain two preimages and two amounts: a prepayment and a main payment. According to Thomas, the receiver should wait until all the HTLCs (Hashed Time Lock Contracts) of both payments have arrived before fulfilling the HTLCs of the prepayment. If the main payment does not arrive, the prepayment should be failed with a Multi-Path Payment (MPP) timeout. Once the HTLCs of both payments have arrived, the receiver can fulfill the HTLCs of the prepayment and broadcast their on-chain transaction. Thomas notes that the main payment can still fail if the sender never reveals the preimage of the main payment.Dave suggests an alternative approach where the BOLT11 invoice does not necessarily need to contain a payment hash for the prepayment. Instead, it could use a keysend payment with an onion message payload indicating which payment hash to associate with the prepayment. For example, if Alice wants to receive 1 BTC to a specific hash and has a prepayment of 10k sats, the 10k sats can be sent via keysend with metadata indicating that the receiver shouldn't claim it until they receive the 1 BTC HTLC to the specified hash.To implement this alternative approach, Dave proposes extending the BOLT11 invoices with an extra_fee_via_keysend field. This would make the invoice significantly smaller and allow encoding the extra_fee_via_keysend field in existing BOLT11 fields like the description or metadata field. This immediate implementation could be used until an updated version of BOLT11 or an alternative using offers becomes widely deployed.Overall, the email exchange discusses the semantics of bundled payments in BOLT-11 invoices and explores an alternative approach using keysend payments with associated payment hashes. The proposed approach suggests extending the BOLT11 invoices with an extra_fee_via_keysend field for efficient implementation.</p>
    <hr>
    <p><i> Updated on: 2023-07-08T02:46:38.920571+00:00 </i></p>
    
    

    <footer>
        <span style="font-family: Arial, Helvetica, sans-serif;">&#10084;&#65039;</span> <a href="https://chaincode.com" target="_blank" rel="noreferrer" style="text-decoration: none; color: inherit;">Chaincode</a>
    </footer>
</body>

</html>