<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=us-ascii">
    <title>Atom Feed Display</title>
    <link rel="stylesheet" href="../../archive_styles.css">
</head>

<body BGCOLOR="#fffffb">
    
    <h1>Proposal: Bundled payments</h1>
    <hr class="solid">
    
    <ul>
        
        
            <p><b>Author:</b> Thomas Voegtlin 2023-06-13 08:10:29+00:00
            <br><i>Published on: 2023-06-13T08:10:29+00:00</i></p>

        
        

        
        
        <li>
        <a href="/lightning-dev/June_2023/combined_Proposal-Bundled-payments.html"> Combined Summary of all posts in thread </a>
        </li>
        
        <li>
            
                <a href="https://lists.linuxfoundation.org/pipermail/lightning-dev/2023-June/003977.html">Click here to read original discussion on the lightning-dev mailing list</a>
            
        </li>

    </ul>

    <hr>
    <h3> Summary:</h3>
    <p>Proposal for Extension to BOLT-11: Bundled PaymentsThomasV is proposing an extension to BOLT-11, where invoices can contain two bundled payments with distinct preimages and amounts. This extension is intended for services that require a prepayment of a mining fee for non-custodian exchanges such as submarine swaps and JIT channels.In the case of submarine swaps, services like Loop by Lightning Labs can ask for a prepayment because their software can handle it. However, competitors like Boltz Exchange, which require a dedicated wallet, cannot do this effectively. Without the ability to request prepayment, Boltz is vulnerable to denial-of-service (DoS) attacks where attackers force them to pay on-chain fees.JIT channel providers who want to protect themselves from mining fee attacks also need to ask for the preimage of the main payment before opening the channel. However, asking for the preimage first makes the service custodian, potentially falling under European MICA regulation. Competitors like Electrum, who refuse to offer custodian services, are excluded from this game.To solve these issues, ThomasV suggests bundling the prepayment and main payment in the same BOLT-11 invoice. The proposed semantics of bundled payments are as follows: the invoice contains two preimages and two amounts, and the receiver should wait until all HTLCs of both payments have arrived before fulfilling the prepayment HTLCs. If the main payment does not arrive, they should fail the prepayment with a MPP timeout. Once both payments' HTLCs have arrived, the receiver fulfills the prepayment HTLCs and broadcasts their on-chain transaction. It's important to note that the main payment can still fail if the sender never reveals the preimage.While ThomasV acknowledges that this proposal doesn't prevent service providers from stealing the prepayment, he believes it would level the playing field for competition between lightning service providers. Currently, Loop requires a dedicated client, leaving competitors without an established user base exposed to mining fee attacks. Additionally, ACINQ could benefit from this extension by making their pay-to-open service fully non-custodian to avoid falling under European MICA regulation.ThomasV argues that this change should be implemented in BOLT-11 rather than using BOLT-12 or onion messages. He believes the proposal doesn't require the exchange of new messages and can be done in a non-interactive way. This would prevent unnecessary complications.In conclusion, ThomasV's proposal for bundled payments in BOLT-11 aims to address the limitations faced by lightning service providers regarding prepayment and mining fee attacks. By bundling the prepayment and main payment in the same invoice, it could enhance competition and enable non-custodian services while avoiding regulatory concerns.</p>
    <hr>
    <p><i> Updated on: 2023-07-12T02:45:14.817523+00:00 </i></p>
    
    

    <footer>
        <span style="font-family: Arial, Helvetica, sans-serif;">&#10084;&#65039;</span> <a href="https://chaincode.com" target="_blank" rel="noreferrer" style="text-decoration: none; color: inherit;">Chaincode</a>
    </footer>
</body>

</html>