<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=us-ascii">
    <title>Atom Feed Display</title>
    <link rel="stylesheet" href="../../archive_styles.css">
</head>

<body BGCOLOR="#fffffb">
    
    <h1>Proposal: Bundled payments</h1>
    <hr class="solid">
    
    <ul>
        
        
            <p><b>Author:</b> Thomas Voegtlin 2023-06-13 08:10:29+00:00
            <br><i>Published on: 2023-06-13T08:10:29+00:00</i></p>

        
        

        
        
        <li>
        <a href="/lightning-dev/June_2023/combined_Proposal-Bundled-payments.html"> Combined Summary of all posts in thread </a>
        </li>
        
        <li>
            
                <a href="https://lists.linuxfoundation.org/pipermail/lightning-dev/2023-June/003977.html">Click here to read original discussion on the lightning-dev mailing list</a>
            
        </li>

    </ul>

    <hr>
    <h3> Summary:</h3>
    <p>ThomasV has proposed an extension to the BOLT-11 protocol, allowing invoices to contain two bundled payments with distinct preimages and amounts. This extension is intended for use cases such as submarine swaps and JIT (Just-In-Time) channels, where service providers require prepayment of a mining fee before a non-custodian exchange can occur.In both submarine swaps and JIT channels, the service provider receives a Hashed Time-Locked Contract (HTLC) for which they do not have the preimage. To proceed with the exchange, they must send funds on-chain and wait for the client to reveal the preimage when claiming the payment. However, since there is no guarantee that the client will actually claim the payment, service providers typically ask for prepayment of mining fees.The issue arises with services like Boltz exchange, which cannot ask for prepayment due to the use of a dedicated client software that handles it. This leaves them vulnerable to Denial-of-Service (DoS) attacks, where an attacker forces them to pay on-chain fees. Similarly, in the case of JIT channels, service providers who want to protect themselves against mining fee attacks need to ask for the preimage of the main payment before opening the channel. However, this makes their service custodian, subject to legal regulations such as European MICA.To address these challenges, ThomasV proposes bundling the prepayment and main payment in the same BOLT-11 invoice. The semantics of bundled payments would involve including two preimages and two amounts in the invoice. The receiver would wait until all HTLCs of both payments have arrived before fulfilling the HTLCs of the prepayment. If the main payment does not arrive, the prepayment would fail with a Multi-Path Payment (MPP) timeout. Once both payments' HTLCs have arrived, the receiver would fulfill the HTLCs of the prepayment and broadcast the on-chain transaction. However, the main payment can still fail if the sender never reveals the preimage.While this proposal does not prevent service providers from stealing the prepayment, it aims to level the field in terms of competition between lightning service providers. Currently, competitors without an established user base running a dedicated client are exposed to mining fee attacks, whereas services like Loop by Lightning Labs can ask for prepayment. ACINQ could also benefit from this proposal, allowing their pay-to-open service to become fully non-custodian and potentially avoiding regulatory issues under European MICA.ThomasV believes that this change should be implemented in BOLT-11 rather than using BOLT-12 or onion messages. He argues that the proposal does not require the exchange of new messages and that adding unnecessary complexity should be avoided.Overall, ThomasV's proposal seeks to enhance the functionality of BOLT-11 invoices by introducing bundled payments, addressing challenges faced by lightning service providers and promoting fair competition within the ecosystem.</p>
    <hr>
    <p><i> Updated on: 2023-07-11T02:36:43.625354+00:00 </i></p>
    
    

    <footer>
        <span style="font-family: Arial, Helvetica, sans-serif;">&#10084;&#65039;</span> <a href="https://chaincode.com" target="_blank" rel="noreferrer" style="text-decoration: none; color: inherit;">Chaincode</a>
    </footer>
</body>

</html>