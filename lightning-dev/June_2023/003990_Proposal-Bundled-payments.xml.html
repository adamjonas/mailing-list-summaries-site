<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=us-ascii">
    <title>Atom Feed Display</title>
    <link rel="stylesheet" href="../../archive_styles.css">
</head>

<body BGCOLOR="#fffffb">
    
    <h1>Proposal: Bundled payments</h1>
    <hr class="solid">
    
    <ul>
        
        
            <p><b>Author:</b> SomberNight 2023-06-20 16:49:05+00:00
            <br><i>Published on: 2023-06-20T16:49:05+00:00</i></p>

        
        

        
        
        <li>
        <a href="/lightning-dev/June_2023/combined_Proposal-Bundled-payments.xml.html"> Combined Summary of all posts in thread </a>
        </li>
        
        <li>
            
                <a href="https://lists.linuxfoundation.org/pipermail/lightning-dev/2023-June/003990.html">Click here to read original discussion on the lightning-dev mailing list</a>
            
        </li>

    </ul>

    <hr>
    <h3> Summary:</h3>
    <p>The proposal seeks to extend BOLT-11 to include two bundled payments with distinct preimages and amounts. This extension is intended for services that require a prepayment of a mining fee such as submarine swaps and JIT channels. The use case involves three entities: the user, the swap service provider (server), and the payee.An example of how this would work is given for the submarine swap scenario. Alice generates an invoice, which Bob pays using Lightning. Using a swap service, Bob could pay Alice so that he pays on Lightning, and Alice receives on-chain. Only Alice knows about the swap server being there. Bob sees that the invoice contains two payment hashes and amounts and sends HTLCs to cover both. The HTLCs arrive at the swap server, who holds them and waits until it sees HTLCs with enough money offered for both the prepayment and the main payment. The server then fulfills the HTLCs for the prepayment because it has the preimage for the prepayment. In addition to swaps, the other use case is JIT channels where Alice could negotiate with the service provider to have a JIT channel opened to her, and the HTLC forwarded using that. Bob is completely agnostic to what happens between the service provider and Alice. The only thing visible is the long time it takes for the HTLC to get fulfilled. The author proposes to add this feature to Bolt 12 rather than Bolt 11 because it requires new sender code.However, providers using JIT channels need to protect themselves against mining fee attacks by asking for the preimage of the main payment before opening the channel. This makes the service custodian and subject to European MICA regulation. To address this issue, the author proposes bundling the prepayment and the main payment in the same BOLT-11 invoice. The receiver should wait until all the HTLCs of both payments have arrived before fulfilling the HTLCs of the pre-payment, with the option to fail the pre-payment with an MPP timeout if the main payment does not arrive. The proposed change in BOLT-11 would level the field in terms of competition between Lightning service providers and make it possible for ACINQ to make their pay-to-open service fully non-custodian. The proposal suggests implementing this change in BOLT-11 rather than using BOLT-12 or onion messages to avoid adding new messages when things can be done in a non-interactive way. However, Boltz, a Lightning Network provider, is vulnerable to DoS attacks that force them to pay on-chain fees due to the unpracticality of showing two invoices to be paid simultaneously.</p>
    <hr>
    <p><i> Updated on: 2023-06-23T01:42:59.245061+00:00 </i></p>
    
    

    <footer>
        <span style="font-family: Arial, Helvetica, sans-serif;">&#10084;&#65039;</span> <a href="https://chaincode.com" target="_blank" rel="noreferrer" style="text-decoration: none; color: inherit;">Chaincode</a>
    </footer>
</body>

</html>