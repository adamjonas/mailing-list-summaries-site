<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=us-ascii">
    <title>Atom Feed Display</title>
    <link rel="stylesheet" href="../../archive_styles.css">
</head>

<body BGCOLOR="#fffffb">
    
    <h1>Proposal: Bundled payments</h1>
    <hr class="solid">
    
    <ul>
        
        
            <p><b>Author:</b> SomberNight 2023-06-20 16:49:05+00:00
            <br><i>Published on: 2023-06-20T16:49:05+00:00</i></p>

        
        

        
        
        <li>
        <a href="/lightning-dev/June_2023/combined_Proposal-Bundled-payments.xml.html"> Combined Summary of all posts in thread </a>
        </li>
        
        <li>
            
                <a href="https://lists.linuxfoundation.org/pipermail/lightning-dev/2023-June/003990.html">Click here to read original discussion on the lightning-dev mailing list</a>
            
        </li>

    </ul>

    <hr>
    <h3> Summary:</h3>
    <p>The proposal to extend BOLT-11 involves bundling two payments with distinct preimages and amounts, which would allow non-custodian exchange services like Submarine swaps and JIT channels to require prepayment of a mining fee for the exchange to take place. In the case of submarine swaps, Alice generates a preimage and calculates its hash RHASH1 for the actual amount she wants to receive. She contacts the swap server via HTTP, providing RHASH1 and amount1. The server generates another preimage and its hash RHASH2 for the small prepayment amount2, and puts (RHASH1, amount1) and (RHASH2, amount2) in a lightning invoice that is sent back to Alice. Alice gives the invoice to Bob, who does not need to know that the nodeid signing the ln invoice does not belong to Alice.The HTLCs arrive at the swap server, who holds them and waits until it sees HTLCs with enough offered money for both the prepayment (RHASH2) and the main payment (RHASH1). Only Alice knows about the swap service provider being there, and all the security checks and swap logic are only implemented on Alice's side. Another use case for the proposed extension is JIT channels, where the server is only trusted with the prepayment amount.However, Boltz is vulnerable to DoS attacks when they have to pay on-chain fees for two invoices at the same time. Providers need to ask for the preimage of the main payment before opening the channel, making them custodian from a legal perspective. To solve this problem, ThomasV proposes bundling the prepayment and main payment in the same BOLT-11 invoice, which would involve two preimages and amounts. The receiver waits until all HTLCs of both payments arrive and then fulfills the HTLCs of the pre-payment before broadcasting their on-chain transaction. This proposal would level the playing field between lightning service providers and make it possible for ACINQ to offer a non-custodian pay-to-open service. ThomasV believes this change should be implemented in BOLT-11 rather than using BOLT-12 or onion messages since it does not require the exchange of new messages.</p>
    <hr>
    <p><i> Updated on: 2023-06-27T04:08:07.530020+00:00 </i></p>
    
    

    <footer>
        <span style="font-family: Arial, Helvetica, sans-serif;">&#10084;&#65039;</span> <a href="https://chaincode.com" target="_blank" rel="noreferrer" style="text-decoration: none; color: inherit;">Chaincode</a>
    </footer>
</body>

</html>