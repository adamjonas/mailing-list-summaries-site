<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=us-ascii">
    <title>Atom Feed Display</title>
    <link rel="stylesheet" href="../../archive_styles.css">
</head>

<body BGCOLOR="#fffffb">
    
    <h1>Potential vulnerability in Lightning backends: BOLT-11 &#34;payment hash&#34; does not commit to payment! <span class="combined-summary">[combined summary]</span></h1>
    <hr class="solid">
    <br><b>Individual post summaries:</b>
    
        <ul>
            
                
                    <li>
                        <a href="/lightning-dev/June_2023/003983_Potential-vulnerability-in-Lightning-backends-BOLT-11-payment-hash-does-not-commit-to-payment-.xml.html">Potential vulnerability in Lightning backends: BOLT-11 &#34;payment hash&#34; does not commit to payment!</a>
                        <b>callebtc 2023-06-19 15:26:05+00:00</b>
                    </li>
                
                    <li>
                        <a href="/lightning-dev/June_2023/003986_Potential-vulnerability-in-Lightning-backends-BOLT-11-payment-hash-does-not-commit-to-payment-.xml.html">Potential vulnerability in Lightning backends: BOLT-11 &#34;payment hash&#34; does not commit to payment!</a>
                        <b>Antoine Riard 2023-06-19 20:34:10+00:00</b>
                    </li>
                
            
        </ul>
        
            <a href="https://lists.linuxfoundation.org/pipermail/lightning-dev/2023-June/003983.html">Click here to read the original discussion on the lightning-dev mailing list</a>
        
        <p><i>Published on: 2023-06-19T15:26:05+00:00</i></p>
        <hr>
        <h3>Summary:</h3>
        <p>LNbits, a Lightning Network wallet provider, has discovered an exploit that could allow attackers to create balances out of thin air. The exploit involves abusing a quirk in how invoices are handled internally, allowing the attacker to insert a bolt-11 payment hash of payment A into a different payment and trick the backend into believing that B == A. This means that the backend settles payment internally by crediting A debiting B, and the attacker has "created" 999 satoshis. This method requires a fundamental understanding of bolt-11 and custom tooling to produce the malicious invoice. To mitigate this issue, backends should either use self-generated unique "checking id's" for looking up internal payments or use additional checks to make sure that the invoice details have not been messed around with (e.g., asserting amount(A) == amount(B)). LNBits has already patched this issue in version 0.10.5 and urges users to update as soon as possible. Developers working on custodial wallets, payment processors, account management software, etc. are advised to be aware of this exploit and take necessary measures. It is important to note that this attack highlights the sophistication of LN-savvy attackers and the importance of naming fields accurately. The "payment hash" of an invoice is not a "payment" hash but merely a "preimage" hash, and developers should avoid implicitly assuming that the hash commits to payment details like amount, pubkey, etc.</p>
        <hr>
        <p><i>Updated on: 2023-06-21T01:28:04.024776+00:00</i></p>
    

    

    <footer>
        <span style="font-family: Arial, Helvetica, sans-serif;">&#10084;&#65039;</span> <a href="https://chaincode.com" target="_blank" rel="noreferrer" style="text-decoration: none; color: inherit;">Chaincode</a>
    </footer>
</body>

</html>