<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=us-ascii">
    <title>Atom Feed Display</title>
    <link rel="stylesheet" href="../../archive_styles.css">
</head>

<body BGCOLOR="#fffffb">
    
    <h1>Proposal: Bundled payments</h1>
    <hr class="solid">
    
    <ul>
        
        
            <p><b>Author:</b> Bastien TEINTURIER 2023-06-20 16:44:17+00:00
            <br><i>Published on: 2023-06-20T16:44:17+00:00</i></p>

        
        

        
        
        <li>
        <a href="/lightning-dev/June_2023/combined_Proposal-Bundled-payments.html"> Combined Summary of all posts in thread </a>
        </li>
        
        <li>
            
                <a href="https://lists.linuxfoundation.org/pipermail/lightning-dev/2023-June/003989.html">Click here to read original discussion on the lightning-dev mailing list</a>
            
        </li>

    </ul>

    <hr>
    <h3> Summary:</h3>
    <p>In a recent discussion, Bastien and Thomas discussed the possibility of combining pre-payment of the mining fee with 0-conf (zero-confirmation transactions) in the Lightning Network. Bastien pointed out that he doesn't see 0-conf going away, even with the introduction of BOLT-12. Thomas asked if bundled payments would work with the current specification or require changes to BOLT-12. Bastien explained that it would require adding a TLV (Type-Length-Value) field to Bolt 12 invoices or onion messages. He believes that there is more design space for a prepayment solution based on Bolt 12 and that a more satisfying protocol can be developed.Bastien also expressed his belief that it will take years for BOLT-12 to become the dominant payment method on Lightning after it is merged. On the other hand, he thinks that if the proposed feature was adopted in BOLT-11, it could be deployed much faster. However, Thomas questioned why Bolt 11 would be faster, considering that it also requires software updates and implementers are currently focused on Bolt 12.The goal of Bastien's proposal is to level the playing field of competition between Lightning service providers. While Thomas agrees that having a more satisfying solution is important, he believes that rushing it is not necessary. He suggests building the solution on top of Bolt 12, where they can potentially create something cleaner since invoices are delivered on-the-fly and short-lived.In a separate conversation, Thomas and David discussed the semantics of bundled payments. Thomas explained that a BOLT-11 invoice for bundled payments would contain two preimages and two amounts: prepayment and main payment. The receiver should wait until all the HTLCs (Hashed Time-Locked Contracts) of both payments have arrived before fulfilling the HTLCs of the prepayment. If the main payment never arrives, the prepayment should be failed with a MPP (Multi-Path Payments) timeout. Once the HTLCs of both payments have arrived, the receiver can fulfill the HTLCs of the prepayment and broadcast their on-chain transaction.David proposed an alternative approach where the prepayment could use a keysend payment with the onion message payload indicating what payment hash to associate with the prepayment. Thomas agreed that this could be acceptable and suggested extending BOLT11 invoices with an extra_fee_via_keysend field. This would be smaller in size and could be encoded in an existing BOLT11 field like description or metadata. It could be implemented immediately until an updated version of BOLT11 or an alternative using offers becomes widely deployed.Overall, the discussions revolved around the possibility of combining pre-payment with 0-conf in the Lightning Network, the requirements for bundled payments, and the potential implementation approaches. The focus was on finding a more satisfying solution while considering practical considerations and the current development priorities.</p>
    <hr>
    <p><i> Updated on: 2023-07-01T03:18:25.905418+00:00 </i></p>
    
    

    <footer>
        <span style="font-family: Arial, Helvetica, sans-serif;">&#10084;&#65039;</span> <a href="https://chaincode.com" target="_blank" rel="noreferrer" style="text-decoration: none; color: inherit;">Chaincode</a>
    </footer>
</body>

</html>