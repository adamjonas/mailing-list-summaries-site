<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=us-ascii">
    <title>Atom Feed Display</title>
    <link rel="stylesheet" href="../../archive_styles.css">
</head>

<body BGCOLOR="#fffffb">
    
    <h1>Potential vulnerability in Lightning backends: BOLT-11 &#34;payment hash&#34; does not commit to payment!</h1>
    <hr class="solid">
    
    <ul>
        
        
            <p><b>Author:</b> Antoine Riard 2023-06-19 20:34:10+00:00
            <br><i>Published on: 2023-06-19T20:34:10+00:00</i></p>

        
        

        
        
        <li>
        <a href="/lightning-dev/June_2023/combined_Potential-vulnerability-in-Lightning-backends-BOLT-11-payment-hash-does-not-commit-to-payment-.html"> Combined Summary of all posts in thread </a>
        </li>
        
        <li>
            
                <a href="https://lists.linuxfoundation.org/pipermail/lightning-dev/2023-June/003986.html">Click here to read original discussion on the lightning-dev mailing list</a>
            
        </li>

    </ul>

    <hr>
    <h3> Summary:</h3>
    <p>LNbits, a Lightning Network application, has patched an exploit that allowed attackers to create balances out of thin air by manipulating invoices. The exploit involved inserting the payment hash of one payment into a different payment, tricking the backend into believing that the two payments were equal. The attacker would create an invoice A in LNbits and another invoice B' on their own node. They would then modify B' by replacing its payment hash with the payment hash of A, creating a malicious invoice B. When the attacker created a new account in LNbits and paid invoice B, the backend would check the payment hash and find invoice A in its database, assuming that the payment hash committed to the payment details. As a result, the backend would settle the payment internally by crediting invoice A and debiting invoice B, effectively creating 999 satoshis out of thin air.To mitigate this issue, backends can use unique "checking ids" for looking up internal payments or implement additional checks to ensure that the invoice details have not been tampered with. It is important for developers to understand the level of sophistication displayed by attackers in the Lightning Network ecosystem and to be aware that the "payment hash" in an invoice is actually a "preimage" hash and does not commit to payment details like the amount or pubkey.LNbits has patched this exploit in version 0.10.5 and urges users to update their installations. Other custodial wallets, payment processors, and account management software based on LDK (Lightning Development Kit) should also review their implementations to ensure they are not vulnerable to similar attacks. It is recommended to follow good disclosure security practices and notify the maintainers of Lightning implementations about any potential vulnerabilities to facilitate patch coordination with second-line vendors.</p>
    <hr>
    <p><i> Updated on: 2023-07-09T03:01:34.069583+00:00 </i></p>
    
    

    <footer>
        <span style="font-family: Arial, Helvetica, sans-serif;">&#10084;&#65039;</span> <a href="https://chaincode.com" target="_blank" rel="noreferrer" style="text-decoration: none; color: inherit;">Chaincode</a>
    </footer>
</body>

</html>