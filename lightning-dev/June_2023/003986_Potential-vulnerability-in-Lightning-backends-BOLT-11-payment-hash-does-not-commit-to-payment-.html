<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=us-ascii">
    <title>Atom Feed Display</title>
    <link rel="stylesheet" href="../../archive_styles.css">
</head>

<body BGCOLOR="#fffffb">
    
    <h1>Potential vulnerability in Lightning backends: BOLT-11 &#34;payment hash&#34; does not commit to payment!</h1>
    <hr class="solid">
    
    <ul>
        
        
            <p><b>Author:</b> Antoine Riard 2023-06-19 20:34:10+00:00
            <br><i>Published on: 2023-06-19T20:34:10+00:00</i></p>

        
        

        
        
        <li>
        <a href="/lightning-dev/June_2023/combined_Potential-vulnerability-in-Lightning-backends-BOLT-11-payment-hash-does-not-commit-to-payment-.html"> Combined Summary of all posts in thread </a>
        </li>
        
        <li>
            
                <a href="https://lists.linuxfoundation.org/pipermail/lightning-dev/2023-June/003986.html">Click here to read original discussion on the lightning-dev mailing list</a>
            
        </li>

    </ul>

    <hr>
    <h3> Summary:</h3>
    <p>The email thread discusses a recent exploit discovered by LNbits that allows an attacker to create balances by manipulating invoices. The exploit has been patched in LNbits version 0.10.5, and the team urges users to update their software. The attack involves inserting a payment hash from one payment into a different payment, tricking the backend into believing they are equal.The attacker creates two invoices, A and B', with different amounts. They then modify invoice B' by replacing its payment hash with the payment hash from invoice A, creating a malicious invoice B. The attacker then creates a new account in LNbits and pays invoice B. The LNbits backend, which checks payment hashes to determine if payments are internal or via the Lightning Network, finds invoice A in its database. However, the critical flaw is that payment hashes only commit to the preimage and not to payment details like amount. As a result, the backend settles the payment internally by crediting invoice A and debiting invoice B, effectively creating 999 satoshis out of thin air.To mitigate this issue, backends should use unique "checking ids" to look up internal payments or implement additional checks to ensure that invoice details have not been tampered with. The email also highlights the sophistication of LN-savvy attackers and emphasizes the need to understand the nature of payment hashes, which are actually preimage hashes and do not commit to payment details.Overall, the email serves as a warning to custodial wallets, payment processors, and account management software developers to be aware of this exploit and take necessary precautions. It also suggests following good disclosure security practices by informing Lightning implementation maintainers about potential security vulnerabilities.</p>
    <hr>
    <p><i> Updated on: 2023-07-01T03:23:41.002969+00:00 </i></p>
    
    

    <footer>
        <span style="font-family: Arial, Helvetica, sans-serif;">&#10084;&#65039;</span> <a href="https://chaincode.com" target="_blank" rel="noreferrer" style="text-decoration: none; color: inherit;">Chaincode</a>
    </footer>
</body>

</html>