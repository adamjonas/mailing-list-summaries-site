<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=us-ascii">
    <title>Atom Feed Display</title>
    <link rel="stylesheet" href="../../archive_styles.css">
</head>

<body BGCOLOR="#fffffb">
    
    <h1>Potential vulnerability in Lightning backends: BOLT-11 &#34;payment hash&#34; does not commit to payment!</h1>
    <hr class="solid">
    
    <ul>
        
        
            <p><b>Author:</b> Antoine Riard 2023-06-19 20:34:10+00:00
            <br><i>Published on: 2023-06-19T20:34:10+00:00</i></p>

        
        

        
        
        <li>
        <a href="/lightning-dev/June_2023/combined_Potential-vulnerability-in-Lightning-backends-BOLT-11-payment-hash-does-not-commit-to-payment-.html"> Combined Summary of all posts in thread </a>
        </li>
        
        <li>
            
                <a href="https://lists.linuxfoundation.org/pipermail/lightning-dev/2023-June/003986.html">Click here to read original discussion on the lightning-dev mailing list</a>
            
        </li>

    </ul>

    <hr>
    <h3> Summary:</h3>
    <p>LNbits, a Lightning Network application, has patched an exploit that allowed attackers to create balances by manipulating invoices. The exploit involved inserting the payment hash of one payment into a different payment, tricking the backend into thinking they were equivalent. The attacker would create two invoices, one in LNbits and one on their own node, and then modify the second invoice to include the payment hash of the first. When the attacker paid the modified invoice using a new account in LNbits, the backend would mistakenly credit the first invoice and debit the second, effectively creating 999 satoshis out of thin air. To mitigate this type of attack, backends should use unique "checking ids" for internal payments or perform additional checks to ensure the integrity of the invoice details. It is important to note that the "payment hash" of an invoice is actually a "preimage" hash and does not commit to payment details such as the amount or public key. The naming of this field can lead to developers making incorrect assumptions about its functionality. LNbits recommends that custodial wallets, payment processors, and account management software update to the patched version (0.10.5) to prevent exploitation. This attack highlights the sophistication of LN-savvy attackers and the need for increased awareness of potential vulnerabilities within Lightning applications.</p>
    <hr>
    <p><i> Updated on: 2023-06-30T03:03:24.261298+00:00 </i></p>
    
    

    <footer>
        <span style="font-family: Arial, Helvetica, sans-serif;">&#10084;&#65039;</span> <a href="https://chaincode.com" target="_blank" rel="noreferrer" style="text-decoration: none; color: inherit;">Chaincode</a>
    </footer>
</body>

</html>