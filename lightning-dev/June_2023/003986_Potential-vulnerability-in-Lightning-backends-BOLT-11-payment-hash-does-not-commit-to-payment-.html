<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=us-ascii">
    <title>Atom Feed Display</title>
    <link rel="stylesheet" href="../../archive_styles.css">
</head>

<body BGCOLOR="#fffffb">
    
    <h1>Potential vulnerability in Lightning backends: BOLT-11 &#34;payment hash&#34; does not commit to payment!</h1>
    <hr class="solid">
    
    <ul>
        
        
            <p><b>Author:</b> Antoine Riard 2023-06-19 20:34:10+00:00
            <br><i>Published on: 2023-06-19T20:34:10+00:00</i></p>

        
        

        
        
        <li>
        <a href="/lightning-dev/June_2023/combined_Potential-vulnerability-in-Lightning-backends-BOLT-11-payment-hash-does-not-commit-to-payment-.html"> Combined Summary of all posts in thread </a>
        </li>
        
        <li>
            
                <a href="https://lists.linuxfoundation.org/pipermail/lightning-dev/2023-June/003986.html">Click here to read original discussion on the lightning-dev mailing list</a>
            
        </li>

    </ul>

    <hr>
    <h3> Summary:</h3>
    <p>The email exchange discusses an exploit discovered by LNbits that allows an attacker to create balances by manipulating invoices. The exploit has been patched in LNbits version 0.10.5, and users are advised to update their software. The attacker was able to insert a payment hash from one invoice into another, tricking the backend into believing they are the same. The critical issue is that payment hashes do not commit to payment details like the amount, but only to the preimage. As a result, the backend settles the payment internally by crediting one invoice and debiting the other, allowing the attacker to create funds out of thin air. To mitigate this vulnerability, backends should use unique "checking ids" for internal payments or perform additional checks to ensure the integrity of invoice details. The email emphasizes the need for developers to understand the sophistication of Lightning Network attackers and suggests renaming the "payment hash" field to "preimage hash" to avoid implicit assumptions about its functionality.</p>
    <hr>
    <p><i> Updated on: 2023-06-29T03:02:43.105275+00:00 </i></p>
    
    

    <footer>
        <span style="font-family: Arial, Helvetica, sans-serif;">&#10084;&#65039;</span> <a href="https://chaincode.com" target="_blank" rel="noreferrer" style="text-decoration: none; color: inherit;">Chaincode</a>
    </footer>
</body>

</html>