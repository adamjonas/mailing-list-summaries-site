<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=us-ascii">
    <title>Atom Feed Display</title>
    <link rel="stylesheet" href="../../archive_styles.css">
</head>

<body BGCOLOR="#fffffb">
    
    <h1>Potential vulnerability in Lightning backends: BOLT-11 &#34;payment hash&#34; does not commit to payment!</h1>
    <hr class="solid">
    
    <ul>
        
        
            <p><b>Author:</b> Antoine Riard 2023-06-19 20:34:10+00:00
            <br><i>Published on: 2023-06-19T20:34:10+00:00</i></p>

        
        

        
        
        <li>
        <a href="/lightning-dev/June_2023/combined_Potential-vulnerability-in-Lightning-backends-BOLT-11-payment-hash-does-not-commit-to-payment-.html"> Combined Summary of all posts in thread </a>
        </li>
        
        <li>
            
                <a href="https://lists.linuxfoundation.org/pipermail/lightning-dev/2023-June/003986.html">Click here to read original discussion on the lightning-dev mailing list</a>
            
        </li>

    </ul>

    <hr>
    <h3> Summary:</h3>
    <p>The email exchange discusses an exploit discovered by LNbits that allows an attacker to create balances by manipulating invoices in Lightning applications. The exploit has been patched in LNbits version 0.10.5, and users are urged to update their software. The attack involves inserting a payment hash from one invoice into another, tricking the backend into believing they are equal. The attacker then creates a new account and pays the manipulated invoice, resulting in the creation of additional funds.To mitigate this vulnerability, backends should use unique "checking ids" for internal payments or implement additional checks to ensure the integrity of invoice details. The email highlights the importance of understanding the sophistication of attackers in the Lightning Network and emphasizes that the "payment hash" is actually a "preimage" hash, which does not commit to payment details like the amount or pubkey.The email advises developers to refer to the field as the "preimage hash" to avoid any implicit assumptions about its functionality. Additionally, it suggests following good disclosure security practices by notifying Lightning implementation maintainers about vulnerabilities to facilitate patch coordination with second-line vendors such as wallets and processors.Overall, the email serves as a warning to those working on custodial wallets, payment processors, and account management software to be aware of this exploit and take necessary precautions to protect their systems.</p>
    <hr>
    <p><i> Updated on: 2023-07-02T03:20:07.466271+00:00 </i></p>
    
    

    <footer>
        <span style="font-family: Arial, Helvetica, sans-serif;">&#10084;&#65039;</span> <a href="https://chaincode.com" target="_blank" rel="noreferrer" style="text-decoration: none; color: inherit;">Chaincode</a>
    </footer>
</body>

</html>