<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=us-ascii">
    <title>Atom Feed Display</title>
    <link rel="stylesheet" href="../../archive_styles.css">
</head>

<body BGCOLOR="#fffffb">
    
    <h1>Proposal: Bundled payments</h1>
    <hr class="solid">
    
    <ul>
        
        
            <p><b>Author:</b> Matt Corallo 2023-06-14 17:28:04+00:00
            <br><i>Published on: 2023-06-14T17:28:04+00:00</i></p>

        
        

        
        
        <li>
        <a href="/lightning-dev/June_2023/combined_Proposal-Bundled-payments.html"> Combined Summary of all posts in thread </a>
        </li>
        
        <li>
            
                <a href="https://lists.linuxfoundation.org/pipermail/lightning-dev/2023-June/003980.html">Click here to read original discussion on the lightning-dev mailing list</a>
            
        </li>

    </ul>

    <hr>
    <h3> Summary:</h3>
    <p>The author of the email, Thomas Voegtlin, is proposing an extension to BOLT-11, the Lightning Network protocol. This extension would allow invoices to contain two bundled payments with distinct preimages and amounts. The use case for this extension is for services that require prepayment of a mining fee for non-custodian exchanges such as submarine swaps and JIT channels.In both cases, the service provider receives a Hashed Timelock Contract (HTLC) for which they don't have the preimage. They must send funds on-chain and wait for the client to reveal the preimage when claiming the payment. To protect against potential loss if the client doesn't claim the payment, service providers ask for prepayment of mining fees.However, there are limitations with the current BOLT-11 specification. Competitors who do not require a dedicated wallet, like Boltz exchange, cannot ask for prepayment. This leaves them vulnerable to denial-of-service attacks where attackers force them to pay on-chain fees. Similarly, in the case of JIT channels, providers who want to protect themselves against mining fee attacks need to ask for the preimage of the main payment before opening the channel. This makes their service custodian, which can have legal implications.To address these issues, Thomas proposes bundling the prepayment and main payment in the same BOLT-11 invoice. The semantics of bundled payments would require the receiver to wait until all HTLCs of both payments have arrived before fulfilling the HTLCs of the prepayment. If the main payment does not arrive, the prepayment should fail with a MPP timeout. Once both payments' HTLCs have arrived, the receiver fulfills the HTLCs of the prepayment and broadcasts the on-chain transaction. However, it's important to note that this proposal does not prevent service providers from stealing the prepayment, which is already a risk.Thomas believes that this proposed change would level the competition field between lightning service providers. Currently, using Loop requires a dedicated client, leaving competitors without a dedicated user base exposed to mining fee attacks. Additionally, he suggests that ACINQ, another lightning service provider, would benefit from this change as it would make their pay-to-open service fully non-custodian.Lastly, Thomas emphasizes that this change should be implemented in BOLT-11 rather than using BOLT-12 or onion messages. He argues that new messages are unnecessary when the proposed functionality can be achieved in a non-interactive way.Overall, Thomas's proposal aims to address limitations and vulnerabilities in the current BOLT-11 specification by allowing invoices to contain bundled payments, providing more flexibility and security for lightning service providers.</p>
    <hr>
    <p><i> Updated on: 2023-07-07T02:49:54.339993+00:00 </i></p>
    
    

    <footer>
        <span style="font-family: Arial, Helvetica, sans-serif;">&#10084;&#65039;</span> <a href="https://chaincode.com" target="_blank" rel="noreferrer" style="text-decoration: none; color: inherit;">Chaincode</a>
    </footer>
</body>

</html>