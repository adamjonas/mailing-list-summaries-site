<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=us-ascii">
    <title>Atom Feed Display</title>
    <link rel="stylesheet" href="../../archive_styles.css">
</head>

<body BGCOLOR="#fffffb">
    
    <h1>Proposal: Bundled payments</h1>
    <hr class="solid">
    
    <ul>
        
        
            <p><b>Author:</b> Matt Corallo 2023-06-14 17:28:04+00:00
            <br><i>Published on: 2023-06-14T17:28:04+00:00</i></p>

        
        

        
        
        <li>
        <a href="/lightning-dev/June_2023/combined_Proposal-Bundled-payments.html"> Combined Summary of all posts in thread </a>
        </li>
        
        <li>
            
                <a href="https://lists.linuxfoundation.org/pipermail/lightning-dev/2023-June/003980.html">Click here to read original discussion on the lightning-dev mailing list</a>
            
        </li>

    </ul>

    <hr>
    <h3> Summary:</h3>
    <p>It seems that there is skepticism about the feasibility of introducing any new interoperable changes to BOLT-11. The author believes that even getting amount-less BOLT-11 invoices widely supported is already a challenge, so rolling out another incompatible version of BOLT-11 and expecting the entire ecosystem to adopt it seems unlikely. The proposal being discussed is an extension to BOLT-11, where an invoice can contain two bundled payments with distinct preimages and amounts. This extension is intended to address the use case of services that require prepayment of a mining fee for non-custodian exchanges like submarine swaps and JIT channels. In these cases, service providers receive HTLCs for which they do not have the preimage and need to send funds on-chain while waiting for the client to reveal the preimage. To mitigate the risk of clients not claiming the payment, service providers ask for prepayment of mining fees.For services like Loop by Lightning Labs, which use dedicated client software, asking for prepayment is possible. However, competitors like the Boltz exchange, which don't require a dedicated wallet, face challenges in handling prepayments. This creates a vulnerability where attackers can force them to pay on-chain fees, resulting in potential DoS attacks.In the case of JIT channels, providers who want to protect themselves against mining fee attacks need to ask for the preimage of the main payment before opening the channel. However, this makes the service custodian, which has legal implications under European MICA regulation. Competitors that refuse to offer custodian services are excluded from participating.To address these issues, the proposal suggests bundling the prepayment and main payment in the same BOLT-11 invoice. The semantics of bundled payments involve including two preimages and two amounts in the invoice. The receiver should wait until all HTLCs from both payments have arrived before fulfilling the HTLCs of the prepayment. If the main payment does not arrive, the prepayment should be failed with a MPP timeout. Once both payments' HTLCs have arrived, the receiver fulfills the HTLCs of the prepayment and broadcasts the on-chain transaction.The author acknowledges that this proposal does not prevent service providers from stealing the prepayment, but argues that this is already a risk in the current system.The author believes that implementing this change in BOLT-11, rather than using BOLT-12 or onion messages, would be beneficial. They argue that the proposal does not require the exchange of new messages and can be done in a non-interactive way, making it less complicated.Overall, the proposed extension to BOLT-11 aims to level the playing field for lightning service providers, enable non-custodian pay-to-open services, and address regulatory concerns. The author suggests that ACINQ and other providers would benefit from this change.</p>
    <hr>
    <p><i> Updated on: 2023-06-28T03:19:20.584286+00:00 </i></p>
    
    

    <footer>
        <span style="font-family: Arial, Helvetica, sans-serif;">&#10084;&#65039;</span> <a href="https://chaincode.com" target="_blank" rel="noreferrer" style="text-decoration: none; color: inherit;">Chaincode</a>
    </footer>
</body>

</html>