<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=us-ascii">
    <title>Atom Feed Display</title>
    <link rel="stylesheet" href="../../archive_styles.css">
</head>

<body BGCOLOR="#fffffb">
    
    <h1>Proposal: Bundled payments</h1>
    <hr class="solid">
    
    <ul>
        
        
            <p><b>Author:</b> Matt Corallo 2023-06-14 17:28:04+00:00
            <br><i>Published on: 2023-06-14T17:28:04+00:00</i></p>

        
        

        
        
        <li>
        <a href="/lightning-dev/June_2023/combined_Proposal-Bundled-payments.html"> Combined Summary of all posts in thread </a>
        </li>
        
        <li>
            
                <a href="https://lists.linuxfoundation.org/pipermail/lightning-dev/2023-June/003980.html">Click here to read original discussion on the lightning-dev mailing list</a>
            
        </li>

    </ul>

    <hr>
    <h3> Summary:</h3>
    <p>In a recent email thread on the lightning-dev mailing list, Thomas Voegtlin proposed an extension to BOLT-11, which would allow invoices to contain two bundled payments with distinct preimages and amounts. The motivation behind this proposal is to cater to services that require prepayment of mining fees for non-custodian exchanges like submarine swaps and JIT channels. Currently, service providers in these cases have to ask for prepayment of mining fees due to the uncertainty of whether the client will actually claim the payment. However, this approach is not practical for competitors who do not require a dedicated wallet, as it would be challenging to show two invoices simultaneously. This vulnerability exposes them to denial-of-service (DoS) attacks where attackers force them to pay on-chain fees.Similarly, providers of JIT channels need to protect themselves against mining fee attacks by asking for the preimage of the main payment before opening the channel. However, this makes their service custodial, falling within the European MICA regulation. Competitors who refuse to offer custodian services are excluded from this game.To address these issues, Voegtlin proposes bundling the prepayment and main payment in the same BOLT-11 invoice. The semantics of bundled payments involve including two preimages and two amounts in the invoice. The receiver should wait until all the HTLCs (Hashed Time Lock Contracts) of both payments have arrived before fulfilling the HTLCs of the pre-payment. If the main payment does not arrive, the pre-payment should be failed with a MPP (Multi-Path Payments) timeout. Once the HTLCs of both payments have arrived, the receiver can fulfill the HTLCs of the prepayment and broadcast their on-chain transaction.Voegtlin acknowledges that this proposal does not prevent service providers from stealing the pre-payment, but emphasizes that this is already the case today. He believes that implementing this change in BOLT-11, rather than using BOLT-12 or onion messages, would be more straightforward and non-interactive. This change would level the playing field in terms of competition between lightning service providers and potentially benefit ACINQ by allowing them to make their pay-to-open service fully non-custodial.In conclusion, Voegtlin's proposal aims to enhance the functionality of BOLT-11 invoices by introducing bundled payments with distinct preimages and amounts. This change would address the challenges faced by service providers in requiring prepayment of mining fees for non-custodian exchanges and JIT channels.</p>
    <hr>
    <p><i> Updated on: 2023-07-08T02:44:29.639327+00:00 </i></p>
    
    

    <footer>
        <span style="font-family: Arial, Helvetica, sans-serif;">&#10084;&#65039;</span> <a href="https://chaincode.com" target="_blank" rel="noreferrer" style="text-decoration: none; color: inherit;">Chaincode</a>
    </footer>
</body>

</html>