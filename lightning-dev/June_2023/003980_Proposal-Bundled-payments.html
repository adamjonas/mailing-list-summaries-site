<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=us-ascii">
    <title>Atom Feed Display</title>
    <link rel="stylesheet" href="../../archive_styles.css">
</head>

<body BGCOLOR="#fffffb">
    
    <h1>Proposal: Bundled payments</h1>
    <hr class="solid">
    
    <ul>
        
        
            <p><b>Author:</b> Matt Corallo 2023-06-14 17:28:04+00:00
            <br><i>Published on: 2023-06-14T17:28:04+00:00</i></p>

        
        

        
        
        <li>
        <a href="/lightning-dev/June_2023/combined_Proposal-Bundled-payments.html"> Combined Summary of all posts in thread </a>
        </li>
        
        <li>
            
                <a href="https://lists.linuxfoundation.org/pipermail/lightning-dev/2023-June/003980.html">Click here to read original discussion on the lightning-dev mailing list</a>
            
        </li>

    </ul>

    <hr>
    <h3> Summary:</h3>
    <p>In the context provided, Matt expresses skepticism about the possibility of implementing any new interoperable changes to BOLT-11. He argues that the ecosystem already struggles to support amount-less BOLT-11 invoices and introducing another incompatible version would be unlikely to gain widespread support. Thomas Voegtlin proposes an extension to BOLT-11, suggesting the inclusion of two bundled payments with distinct preimages and amounts in an invoice. This proposal is aimed at addressing the need for prepayment of mining fees in certain services such as submarine swaps and JIT channels. In these cases, service providers receive HTLCs without the preimage, necessitating on-chain fund transfers and waiting for the client to reveal the preimage when claiming the payment. To mitigate the risk of non-payment, service providers often require prepayment of mining fees.The issue arises when competitors who don't require dedicated wallets, like the Boltz exchange, cannot ask for prepayment. This vulnerability leaves them susceptible to denial-of-service (DoS) attacks where attackers force them to pay on-chain fees. Similarly, in the case of JIT channels, providers who want to protect themselves against mining fee attacks need to ask for the preimage before opening the channel. However, this makes them custodians, which has legal implications under the European MICA regulation. Competitors who refuse to offer custodian services are excluded from the market.To address these challenges, Thomas suggests bundling the prepayment and main payment in the same BOLT-11 invoice. The proposed semantics of bundled payments involve including two preimages and two amounts in the invoice. The receiver should wait until all HTLCs of both payments have arrived before fulfilling the pre-payment. If the main payment fails to arrive, they should fail the pre-payment with a MPP timeout. Once both payments' HTLCs have arrived, the receiver fulfills the prepayment's HTLCs and broadcasts their on-chain transaction.Thomas acknowledges that this proposal does not prevent service providers from stealing the pre-payment, but argues that the risk already exists. He believes that implementing this change would level the playing field among lightning service providers and benefit ACINQ by allowing them to make their pay-to-open service fully non-custodian. Thomas emphasizes that this change should be implemented in BOLT-11 rather than using BOLT-12 or onion messages. He argues against introducing new messages when a non-interactive approach can achieve the desired outcome.Overall, the proposal aims to address the need for prepayment of mining fees in certain lightning network services, enhance competition among service providers, and mitigate vulnerabilities to DoS attacks and custodial risks.</p>
    <hr>
    <p><i> Updated on: 2023-07-02T03:10:40.601326+00:00 </i></p>
    
    

    <footer>
        <span style="font-family: Arial, Helvetica, sans-serif;">&#10084;&#65039;</span> <a href="https://chaincode.com" target="_blank" rel="noreferrer" style="text-decoration: none; color: inherit;">Chaincode</a>
    </footer>
</body>

</html>