<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=us-ascii">
    <title>Atom Feed Display</title>
    <link rel="stylesheet" href="../../archive_styles.css">
</head>

<body BGCOLOR="#fffffb">
    
    <h1>Proposal: Bundled payments</h1>
    <hr class="solid">
    
    <ul>
        
        
            <p><b>Author:</b> Matt Corallo 2023-06-14 17:28:04+00:00
            <br><i>Published on: 2023-06-14T17:28:04+00:00</i></p>

        
        

        
        
        <li>
        <a href="/lightning-dev/June_2023/combined_Proposal-Bundled-payments.html"> Combined Summary of all posts in thread </a>
        </li>
        
        <li>
            
                <a href="https://lists.linuxfoundation.org/pipermail/lightning-dev/2023-June/003980.html">Click here to read original discussion on the lightning-dev mailing list</a>
            
        </li>

    </ul>

    <hr>
    <h3> Summary:</h3>
    <p>In a recent discussion on the Lightning-dev mailing list, Thomas Voegtlin proposed an extension to BOLT-11, the protocol for Lightning Network invoices. This proposed extension would allow invoices to contain two bundled payments with distinct preimages and amounts. The motivation behind this proposal is to address the use case of services that require prepayment of a mining fee before a non-custodian exchange can take place, such as submarine swaps and JIT channels.Currently, some services that use dedicated client software, like Loop by Lightning Labs, can ask for a prepayment since their software can handle it. However, competitors who do not require a dedicated wallet, such as the Boltz exchange, cannot do the same. This creates a vulnerability where attackers can force these services to pay on-chain fees. Similarly, in the case of JIT channels, providers who want to protect themselves against mining fee attacks need to ask for the preimage of the main payment before opening the channel. This, however, makes them custodians, which has legal implications under European MICA regulation.To solve these issues, Voegtlin suggests bundling the prepayment and the main payment in the same BOLT-11 invoice. The semantics of bundled payments would involve the receiver waiting for all the HTLCs of both payments to arrive before fulfilling the HTLCs of the prepayment. If the main payment does not arrive, the prepayment should be failed with a MPP timeout. Once the HTLCs of both payments have arrived, the receiver fulfills the HTLCs of the prepayment and broadcasts the on-chain transaction.Voegtlin acknowledges that his proposal does not prevent service providers from stealing the prepayment, but he argues that this risk already exists today. He believes that this change would level the playing field in terms of competition between lightning service providers and provide benefits to ACINQ in making their pay-to-open service fully non-custodian.In terms of implementation, Voegtlin suggests that this change should be made in BOLT-11 itself rather than using BOLT-12 or onion messages. He argues that the proposal does not require the exchange of new messages and can be done in a non-interactive way.Overall, Voegtlin's proposal aims to address the need for prepayment of mining fees in certain Lightning Network use cases by allowing invoices to contain bundled payments. This change could improve competition between service providers and mitigate vulnerabilities related to mining fee attacks and custodianship.</p>
    <hr>
    <p><i> Updated on: 2023-07-13T02:55:25.275000+00:00 </i></p>
    
    

    <footer>
        <span style="font-family: Arial, Helvetica, sans-serif;">&#10084;&#65039;</span> <a href="https://chaincode.com" target="_blank" rel="noreferrer" style="text-decoration: none; color: inherit;">Chaincode</a>
    </footer>
</body>

</html>