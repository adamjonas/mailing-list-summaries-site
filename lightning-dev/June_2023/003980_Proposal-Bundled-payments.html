<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=us-ascii">
    <title>Atom Feed Display</title>
    <link rel="stylesheet" href="../../archive_styles.css">
</head>

<body BGCOLOR="#fffffb">
    
    <h1>Proposal: Bundled payments</h1>
    <hr class="solid">
    
    <ul>
        
        
            <p><b>Author:</b> Matt Corallo 2023-06-14 17:28:04+00:00
            <br><i>Published on: 2023-06-14T17:28:04+00:00</i></p>

        
        

        
        
        <li>
        <a href="/lightning-dev/June_2023/combined_Proposal-Bundled-payments.html"> Combined Summary of all posts in thread </a>
        </li>
        
        <li>
            
                <a href="https://lists.linuxfoundation.org/pipermail/lightning-dev/2023-June/003980.html">Click here to read original discussion on the lightning-dev mailing list</a>
            
        </li>

    </ul>

    <hr>
    <h3> Summary:</h3>
    <p>The author of the email, Thomas Voegtlin, proposes an extension to BOLT-11, which is a protocol used for Lightning Network payments. The proposed extension aims to address the issue of services that require prepayment of a mining fee for non-custodian exchanges like submarine swaps and JIT channels.In these cases, the service provider receives a Hash Time-Locked Contract (HTLC) for which they do not have the preimage. They need to send funds on-chain and wait for the client to reveal the preimage when claiming the payment. However, there is no guarantee that the client will claim the payment, so service providers ask for prepayment of mining fees.The problem arises for services like Boltz exchange, which cannot ask for prepayment because their software cannot handle it. This vulnerability exposes them to denial-of-service (DoS) attacks where attackers force them to pay on-chain fees. Similarly, providers who want to protect against mining fee attacks in JIT channels need to ask for the preimage of the main payment before opening the channel. However, doing so makes them custodians and subject to legal regulations.To solve these issues, Voegtlin suggests bundling the prepayment and main payment in the same BOLT-11 invoice. This proposal would ensure that the receiver waits for both payments' HTLCs to arrive before fulfilling the prepayment. If the main payment does not arrive, the prepayment fails with a MPP timeout. Once both payments' HTLCs have arrived, the receiver fulfills the prepayment's HTLCs and broadcasts the on-chain transaction. Voegtlin acknowledges that this proposal does not prevent service providers from stealing the prepayment, but he believes it would level the playing field in terms of competition between lightning service providers. It would also allow ACINQ to make their pay-to-open service fully non-custodian, addressing potential regulatory concerns. Voegtlin argues that this change should be implemented in BOLT-11 rather than using BOLT-12 or onion messages to keep things non-interactive and avoid adding new messages unnecessarily.Overall, the proposed extension aims to improve interoperability and address vulnerabilities in the current system for non-custodian exchanges.</p>
    <hr>
    <p><i> Updated on: 2023-07-04T02:57:35.768563+00:00 </i></p>
    
    

    <footer>
        <span style="font-family: Arial, Helvetica, sans-serif;">&#10084;&#65039;</span> <a href="https://chaincode.com" target="_blank" rel="noreferrer" style="text-decoration: none; color: inherit;">Chaincode</a>
    </footer>
</body>

</html>