<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=us-ascii">
    <title>Atom Feed Display</title>
    <link rel="stylesheet" href="../../archive_styles.css">
</head>

<body BGCOLOR="#fffffb">
    
    <h1>Proposal: Bundled payments</h1>
    <hr class="solid">
    
    <ul>
        
        
            <p><b>Author:</b> Matt Corallo 2023-06-14 17:28:04+00:00
            <br><i>Published on: 2023-06-14T17:28:04+00:00</i></p>

        
        

        
        
        <li>
        <a href="/lightning-dev/June_2023/combined_Proposal-Bundled-payments.html"> Combined Summary of all posts in thread </a>
        </li>
        
        <li>
            
                <a href="https://lists.linuxfoundation.org/pipermail/lightning-dev/2023-June/003980.html">Click here to read original discussion on the lightning-dev mailing list</a>
            
        </li>

    </ul>

    <hr>
    <h3> Summary:</h3>
    <p>The proposal in question is an extension to BOLT-11, which suggests allowing invoices to contain two bundled payments with distinct preimages and amounts. This extension is intended to address the use case of services that require prepayment of a mining fee for non-custodian exchanges, such as submarine swaps and JIT channels. Currently, some service providers ask for prepayment due to the uncertainty of clients claiming payments, but this creates vulnerabilities and limitations for certain competitors.For example, Boltz exchange cannot ask for prepayment because their software cannot handle it, unlike dedicated client software such as Loop by Lightning Labs. This puts Boltz at risk of DoS attacks where attackers force them to pay on-chain fees. Similarly, providers of JIT channels who want to protect themselves against mining fee attacks need to ask for the preimage of the main payment before opening the channel, but this makes them custodians, which may have legal implications.To solve these issues, the proposal suggests bundling the prepayment and main payment in the same BOLT-11 invoice. The semantics of bundled payments are defined as follows: the invoice contains two preimages and two amounts, and the receiver should wait for all HTLCs of both payments to arrive before fulfilling the prepayment HTLCs. If the main payment does not arrive, the prepayment should fail with a MPP timeout. Once both payments' HTLCs have arrived, the receiver fulfills the prepayment HTLCs and broadcasts the on-chain transaction.It is acknowledged that this proposal does not prevent service providers from stealing the prepayment, but this is already a possibility in the current system. The proposed change aims to level the playing field among lightning service providers and enable non-custodian pay-to-open services. It is suggested that implementing this change in BOLT-11, rather than using BOLT-12 or onion messages, would be simpler and more efficient since it does not require the exchange of new messages.Overall, the proposal aims to address the limitations and vulnerabilities faced by certain lightning service providers by allowing bundled payments in BOLT-11 invoices. This change would provide more flexibility and competition in the ecosystem while maintaining a non-custodian approach and avoiding unnecessary complexity.</p>
    <hr>
    <p><i> Updated on: 2023-07-11T02:36:53.476512+00:00 </i></p>
    
    

    <footer>
        <span style="font-family: Arial, Helvetica, sans-serif;">&#10084;&#65039;</span> <a href="https://chaincode.com" target="_blank" rel="noreferrer" style="text-decoration: none; color: inherit;">Chaincode</a>
    </footer>
</body>

</html>