<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=us-ascii">
    <title>Atom Feed Display</title>
    <link rel="stylesheet" href="../../archive_styles.css">
</head>

<body BGCOLOR="#fffffb">
    
    <h1>Proposal: Bundled payments</h1>
    <hr class="solid">
    
    <ul>
        
        
            <p><b>Author:</b> Thomas Voegtlin 2023-06-14 08:09:45+00:00
            <br><i>Published on: 2023-06-14T08:09:45+00:00</i></p>

        
        

        
        
        <li>
        <a href="/lightning-dev/June_2023/combined_Proposal-Bundled-payments.html"> Combined Summary of all posts in thread </a>
        </li>
        
        <li>
            
                <a href="https://lists.linuxfoundation.org/pipermail/lightning-dev/2023-June/003979.html">Click here to read original discussion on the lightning-dev mailing list</a>
            
        </li>

    </ul>

    <hr>
    <h3> Summary:</h3>
    <p>The discussion revolves around the possibility of distributing a submarine swap client separate from the user's lightning wallet, which could enable competition in the space. Boltz, for example, distributes a Progressive Web App and serves JavaScript to perform the necessary checks and sweeps of funds. However, it is unclear whether their app handles everything correctly. This separation between wallet and submarine swap providers could benefit Lightning Loop by increasing its potential user base, but it requires the bundling of fee prepayment and main payment in the same invoice.There is an ongoing standardization effort for LSP (Lightning Service Provider) protocols, with Boltz working on adding submarine swaps to it. The context also discusses the challenges faced by services that require prepayment of mining fees for non-custodian exchanges like submarine swaps and JIT (Just-in-Time) channels. In the case of Boltz, they show an invoice to the user, but it would be impractical for them to show two invoices simultaneously. This vulnerability exposes Boltz to denial-of-service attacks where an attacker forces them to pay on-chain fees.For JIT channels, service providers who want to protect against mining fee attacks need to ask for the preimage of the main payment before opening the channel. However, this makes them custodians, which may have legal implications under European MICA regulation. Competitors like Electrum, who refuse to offer custodian services, are excluded from this game.To address these issues, the proposal suggests extending BOLT-11 to allow for bundled payments in a single invoice. The receiver would wait for both the prepayment and main payment HTLCs to arrive before fulfilling the prepayment HTLCs. If the main payment does not arrive, the prepayment HTLCs would fail with a MPP timeout. Once both payment HTLCs have arrived, the receiver fulfills the prepayment HTLCs and broadcasts the on-chain transaction. This change would level the field and enable competition among lightning service providers.The author believes that this change should be implemented in BOLT-11 rather than using BOLT-12 or onion messages, as it does not require the exchange of new messages and can be done in a non-interactive way. The proposal would benefit ACINQ by allowing them to make their pay-to-open service fully non-custodian. However, there are concerns that the current pay-to-open service used by Phoenix could fall under the European MICA regulation.Overall, the discussion highlights the need for improved functionality and standardization in submarine swap clients and suggests a solution through bundled payments in BOLT-11 invoices.</p>
    <hr>
    <p><i> Updated on: 2023-07-09T02:57:13.330851+00:00 </i></p>
    
    

    <footer>
        <span style="font-family: Arial, Helvetica, sans-serif;">&#10084;&#65039;</span> <a href="https://chaincode.com" target="_blank" rel="noreferrer" style="text-decoration: none; color: inherit;">Chaincode</a>
    </footer>
</body>

</html>