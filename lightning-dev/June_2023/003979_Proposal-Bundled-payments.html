<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=us-ascii">
    <title>Atom Feed Display</title>
    <link rel="stylesheet" href="../../archive_styles.css">
</head>

<body BGCOLOR="#fffffb">
    
    <h1>Proposal: Bundled payments</h1>
    <hr class="solid">
    
    <ul>
        
        
            <p><b>Author:</b> Thomas Voegtlin 2023-06-14 08:09:45+00:00
            <br><i>Published on: 2023-06-14T08:09:45+00:00</i></p>

        
        

        
        
        <li>
        <a href="/lightning-dev/June_2023/combined_Proposal-Bundled-payments.html"> Combined Summary of all posts in thread </a>
        </li>
        
        <li>
            
                <a href="https://lists.linuxfoundation.org/pipermail/lightning-dev/2023-June/003979.html">Click here to read original discussion on the lightning-dev mailing list</a>
            
        </li>

    </ul>

    <hr>
    <h3> Summary:</h3>
    <p>The context discusses the possibility of distributing a submarine swap client separate from the lightning wallet of the user, which would enable competition in the space. Boltz, for example, is distributing a Progressive Web App that serves javascript to perform the necessary checks and sweep the funds. However, it is unclear whether their app is doing everything correctly. Lightning Loop could benefit from this separation by distributing an app that doesn't require a local LND instance, thus expanding its potential user base. The only missing ingredient is bundling fee prepayment and main payment in the same invoice.It is worth noting that there is an ongoing standardization effort for LSP protocols, and Boltz is working to add submarine swaps to it. In a proposal by Thomas Voegtlin, he suggests an extension to BOLT-11 where an invoice can contain two bundled payments with distinct preimages and amounts. This proposal addresses the use case of services requiring prepayment of a mining fee for non-custodian exchanges like submarine swaps and JIT channels. Currently, service providers who use dedicated client software can ask for a prepayment, but competitors who don't require a dedicated wallet, like the Boltz exchange, cannot do so. This leaves them vulnerable to DoS attacks where attackers force them to pay on-chain fees.To protect against mining fee attacks, providers of JIT channels need to ask for the preimage of the main payment before opening the channel. However, this makes them custodians, subject to regulations like the European MICA regulation. Competitors who refuse to offer custodian services are excluded from the game. Bundling the prepayment and main payment in the same BOLT-11 invoice would solve this issue.The proposed semantics of bundled payments involve the receiver waiting for both payments' HTLCs to arrive before fulfilling the prepayment's HTLCs. If the main payment doesn't arrive, the receiver should fail the prepayment with a MPP timeout. Once both payments' HTLCs have arrived, the receiver fulfills the prepayment's HTLCs and broadcasts their on-chain transaction.Thomas Voegtlin believes this proposal would level the field in terms of competition between lightning service providers. It would also benefit ACINQ by making their pay-to-open service fully non-custodian. He suggests implementing this change in BOLT-11 rather than introducing new messages through BOLT-12 or onion messages.Overall, the context explores the potential for distributing submarine swap clients separately from lightning wallets to enable competition. It discusses the need to bundle fee prepayment and main payment in the same invoice and proposes an extension to BOLT-11 to address this issue.</p>
    <hr>
    <p><i> Updated on: 2023-07-07T02:51:26.109965+00:00 </i></p>
    
    

    <footer>
        <span style="font-family: Arial, Helvetica, sans-serif;">&#10084;&#65039;</span> <a href="https://chaincode.com" target="_blank" rel="noreferrer" style="text-decoration: none; color: inherit;">Chaincode</a>
    </footer>
</body>

</html>