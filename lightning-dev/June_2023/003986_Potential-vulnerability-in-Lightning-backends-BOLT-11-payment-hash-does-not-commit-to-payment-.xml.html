<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=us-ascii">
    <title>Atom Feed Display</title>
    <link rel="stylesheet" href="../../archive_styles.css">
</head>

<body BGCOLOR="#fffffb">
    
    <h1>Potential vulnerability in Lightning backends: BOLT-11 &#34;payment hash&#34; does not commit to payment!</h1>
    <hr class="solid">
    
    <ul>
        
        
            <p><b>Author:</b> Antoine Riard 2023-06-19 20:34:10+00:00
            <br><i>Published on: 2023-06-19T20:34:10+00:00</i></p>

        
        

        
        
        <li>
        <a href="/lightning-dev/June_2023/combined_Potential-vulnerability-in-Lightning-backends-BOLT-11-payment-hash-does-not-commit-to-payment-.xml.html"> Combined Summary of all posts in thread </a>
        </li>
        
        <li>
            
                <a href="https://lists.linuxfoundation.org/pipermail/lightning-dev/2023-June/003986.html">Click here to read original discussion on the lightning-dev mailing list</a>
            
        </li>

    </ul>

    <hr>
    <h3> Summary:</h3>
    <p>A potential exploit in LNBits regarding how invoices are handled internally has been discovered. The attacker can create a malicious invoice, B, by inserting the payment hash of payment A into it. When paying B, the backend settles the payment internally by crediting A and debiting B, allowing the attacker to "create" 999 sats out of thin air. The critical part lies in the fact that payment hashes do not commit to any payment details like amount but only to the preimage. Backends should use self-generated unique "checking id's" or additional checks to prevent this kind of attack. Developers should also be aware of the sophistication of LN-savvy attackers and the importance of naming fields accurately. Potential safety issues with invoices have been known since CVE-2020-26896. If you're a custodial wallet, payment processor, or account management software based on LDK, and you respect the API recommendations, you should not be affected as amount equivalence checks are handled by the implementation. Good disclosure security practice suggests having previously warned the Lightning implementation maintainers on their respective security communication channels to ease patch coordination if needed with second-line vendors like wallets and processors.</p>
    <hr>
    <p><i> Updated on: 2023-06-23T01:47:34.147916+00:00 </i></p>
    
    

    <footer>
        <span style="font-family: Arial, Helvetica, sans-serif;">&#10084;&#65039;</span> <a href="https://chaincode.com" target="_blank" rel="noreferrer" style="text-decoration: none; color: inherit;">Chaincode</a>
    </footer>
</body>

</html>