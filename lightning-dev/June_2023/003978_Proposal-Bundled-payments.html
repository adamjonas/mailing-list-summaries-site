<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=us-ascii">
    <title>Atom Feed Display</title>
    <link rel="stylesheet" href="../../archive_styles.css">
</head>

<body BGCOLOR="#fffffb">
    
    <h1>Proposal: Bundled payments</h1>
    <hr class="solid">
    
    <ul>
        
        
            <p><b>Author:</b> Olaoluwa Osuntokun 2023-06-14 02:56:54+00:00
            <br><i>Published on: 2023-06-14T02:56:54+00:00</i></p>

        
        

        
        
        <li>
        <a href="/lightning-dev/June_2023/combined_Proposal-Bundled-payments.html"> Combined Summary of all posts in thread </a>
        </li>
        
        <li>
            
                <a href="https://lists.linuxfoundation.org/pipermail/lightning-dev/2023-June/003978.html">Click here to read original discussion on the lightning-dev mailing list</a>
            
        </li>

    </ul>

    <hr>
    <h3> Summary:</h3>
    <p>In a proposal to extend BOLT-11, Thomas Voegtlin suggests the inclusion of two bundled payments in a single invoice. This proposal addresses the need for prepayment of mining fees in services like submarine swaps and JIT channels. Currently, some service providers require prepayment due to the nature of their dedicated client software. However, competitors who do not use such software, like Boltz exchange, are unable to implement this prepayment feature. This leaves them vulnerable to denial-of-service (DoS) attacks where attackers force them to pay on-chain fees.Similarly, in the case of JIT channels, providers who want to protect themselves against mining fee attacks ask for the preimage of the main payment before opening the channel. However, this approach makes the service custodian, which has legal implications under European MICA regulation. Competitors who refuse to offer custodian services, like Electrum, are excluded from participating in such services.To address these issues, Voegtlin proposes bundling the prepayment and main payment in the same BOLT-11 invoice. The semantics of bundled payments involve including two preimages and two amounts in the invoice. The receiver must wait until all HTLCs (Hashed Time-Locked Contracts) of both payments have arrived before fulfilling the HTLCs of the prepayment. If the main payment does not arrive, the prepayment should fail with a MPP (Multi-Part Payment) timeout. Once the HTLCs of both payments have arrived, the receiver fulfills the HTLCs of the prepayment and broadcasts their on-chain transaction. It is important to note that the main payment can still fail if the sender never reveals the preimage of the main payment.Voegtlin believes that implementing this proposal would level the playing field for competition between lightning service providers. Currently, providers like Loop by Lightning Labs require the use of dedicated clients, while others without an established user base running such clients are susceptible to mining fee attacks. This proposal would also benefit ACINQ by allowing them to make their pay-to-open service fully non-custodian, potentially avoiding regulation under European MICA.Voegtlin suggests that this change should be implemented in BOLT-11 rather than using BOLT-12 or onion messages. He argues that the proposal does not require the exchange of new messages and can be achieved in a non-interactive way without complicating the protocol.Overall, Voegtlin's proposal aims to address the challenges faced by lightning service providers in terms of prepayment of mining fees and the custodian status of certain services. By bundling payments in a single invoice, these issues can be mitigated, ensuring a more competitive and trust-minimized environment for lightning network transactions.</p>
    <hr>
    <p><i> Updated on: 2023-07-02T03:13:24.483894+00:00 </i></p>
    
    

    <footer>
        <span style="font-family: Arial, Helvetica, sans-serif;">&#10084;&#65039;</span> <a href="https://chaincode.com" target="_blank" rel="noreferrer" style="text-decoration: none; color: inherit;">Chaincode</a>
    </footer>
</body>

</html>