<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=us-ascii">
    <title>Atom Feed Display</title>
    <link rel="stylesheet" href="../../archive_styles.css">
</head>

<body BGCOLOR="#fffffb">
    
    <h1>Unclear HTLC scenario <span class="combined-summary">[combined summary]</span></h1>
    <hr class="solid">
    <br><b>Individual post summaries:</b>
    
        <ul>
            
                
                    <li>
                        <a href="/lightning-dev/Dec_2022/003804_Unclear-HTLC-scenario.html">Unclear HTLC scenario</a>
                        <b>Benjamin Weintraub 2022-12-13 20:36:02+00:00</b>
                    </li>
                
                    <li>
                        <a href="/lightning-dev/Dec_2022/003803_Unclear-HTLC-scenario.html">Unclear HTLC scenario</a>
                        <b>SomberNight 2022-12-13 15:53:51+00:00</b>
                    </li>
                
                    <li>
                        <a href="/lightning-dev/Dec_2022/003802_Unclear-HTLC-scenario.html">Unclear HTLC scenario</a>
                        <b>Benjamin Weintraub 2022-12-13 14:51:17+00:00</b>
                    </li>
                
            
        </ul>
        
            <a href="https://lists.linuxfoundation.org/pipermail/lightning-dev/2022-December/003804.html">Click here to read the original discussion on the lightning-dev mailing list</a>
        
        <p><i>Published on: 2022-12-13T20:36:02+00:00</i></p>
        <hr>
        <h3>Summary:</h3>
        <p>In response to Ben's question, SomberNight explained that the scenario of forwarding an HTLC along a channel without sufficient funds is handled before the update_fail_htlc message. When the recipient node receives the update_add_htlc message, it performs sanity checks and if it detects that the payment cannot be supported, it will not commit it to the commitment transaction. In this case, the recipient has the option to simply close the transport connection, causing the update_add_htlc message to be forgotten and restoring the channel to a usable state.To further clarify, BOLT #2 specifies that when a node receives an amount_msat that it cannot afford at the current feerate_per_kw, while still maintaining its channel reserve and any to_local_anchor and to_remote_anchor costs, it should take appropriate action. This can involve sending a warning and closing the connection or sending an error and failing the channel. The context emphasizes that there is no need to wait for an invalid transaction to be received before sending an update_fail_htlc.Overall, the handling of update_fail_htlcs in the scenario described by Ben involves sanity checks performed by the recipient node upon receiving the update_add_htlc message. If the payment cannot be supported, the recipient node can choose to close the connection, leading to the update_add_htlc message being discarded and the channel returning to a usable state.</p>
        <hr>
        <p><i>Updated on: 2023-08-01T00:56:43.738411+00:00</i></p>
    

    

    <footer>
        <span style="font-family: Arial, Helvetica, sans-serif;">&#10084;&#65039;</span> <a href="https://chaincode.com" target="_blank" rel="noreferrer" style="text-decoration: none; color: inherit;">Chaincode</a>
    </footer>
</body>

</html>