<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=us-ascii">
    <title>Atom Feed Display</title>
    <link rel="stylesheet" href="../../archive_styles.css">
</head>

<body BGCOLOR="#fffffb">
    
    <h1>[DRAFT] Multi-cell-hop onion with TLV (and example for multi-part-payment)</h1>
    <hr class="solid">
    
    <ul>
        
        
            <p><b>Author:</b> Rusty Russell 2018-11-29 06:33:06
            <br><i>Published on: 2018-11-29T06:33:06+00:00</i></p>

        
        

        
        
        <li>
        <a href="/lightning-dev/Nov_2018/combined_-DRAFT-Multi-cell-hop-onion-with-TLV-and-example-for-multi-part-payment-.html"> Combined Summary of all posts in thread </a>
        </li>
        
        <li>
            
                <a href="https://lists.linuxfoundation.org/pipermail/lightning-dev/2018-November/001691.html">Click here to read original discussion on the lightning-dev mailing list</a>
            
        </li>

    </ul>

    <hr>
    <h3> Summary:</h3>
    <p>The Lightning Network specification will include a multi-cell structure for onion routing that uses TLV, according to a proposal by Rusty Russell. The structure includes a realm or per-hop type, which expands on the current four bits for 'per_hop_type' to allocate 1-16 cells. An upper four bits are reserved to drop invalid messages. A HMAC is applied to cover the number of per-hops and padding is expanded to 12 bytes plus 65 bytes per extra cell. The padding will contain TLVs in lexicographical order with shortest winning on tiebreaks. The proposal also extends the use of multi-part payments, which allow payments to be split into smaller amounts and sent as separate payments. Type 4 creates a variable-length 'total_payment' field, which specifies the amount of total payment in milli-satoshis. It must only be used for the final hop, if flagged as available, and the reader should reject it if not the final hop. Rusty also suggested using the existence of this field to signal the use of base AMP, instead of a separate flags byte.In addition, he suggested two new types of payment: one for spontaneous payment and another for application data. Spontaneous payments would sacrifice proof-of-payment, while application data could be used for identifying the sender or enabling non-provable games of chance. From a nomenclature standpoint, Rusty suggested using "multi-part-payment" over "base AMP," which he believed was too specific and might limit future developments.</p>
    <hr>
    <p><i> Updated on: 2023-06-02T15:10:35.685676+00:00 </i></p>
    
    

    <footer>
        <span style="font-family: Arial, Helvetica, sans-serif;">&#10084;&#65039;</span> <a href="https://chaincode.com" target="_blank" rel="noreferrer" style="text-decoration: none; color: inherit;">Chaincode</a>
    </footer>
</body>

</html>