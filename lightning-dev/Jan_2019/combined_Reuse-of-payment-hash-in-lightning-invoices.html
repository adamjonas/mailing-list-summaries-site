<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=us-ascii">
    <title>Atom Feed Display</title>
    <link rel="stylesheet" href="../../archive_styles.css">
</head>

<body BGCOLOR="#fffffb">
    
    <h1>Reuse of payment_hash in lightning invoices <span class="combined-summary">[combined summary]</span></h1>
    <hr class="solid">
    <br><b>Individual post summaries:</b>
    
        <ul>
            
                
                    <li>
                        <a href="/lightning-dev/Jan_2019/001786_Reuse-of-payment-hash-in-lightning-invoices.html">Reuse of payment_hash in lightning invoices</a>
                        <b>Andrea RASPITZU 2019-01-03 15:35:01</b>
                    </li>
                
                    <li>
                        <a href="/lightning-dev/Jan_2019/001844_Reuse-of-payment-hash-in-lightning-invoices.html">Reuse of payment_hash in lightning invoices</a>
                        <b>Jose Manuel Arenillas 2019-01-24 18:00:51</b>
                    </li>
                
                    <li>
                        <a href="/lightning-dev/Jan_2019/001782_Reuse-of-payment-hash-in-lightning-invoices.html">Reuse of payment_hash in lightning invoices</a>
                        <b>ZmnSCPxj 2019-01-03 13:13:47</b>
                    </li>
                
                    <li>
                        <a href="/lightning-dev/Jan_2019/001780_Reuse-of-payment-hash-in-lightning-invoices.html">Reuse of payment_hash in lightning invoices</a>
                        <b>Andrea RASPITZU 2019-01-03 12:40:16</b>
                    </li>
                
            
        </ul>
        
            <a href="https://lists.linuxfoundation.org/pipermail/lightning-dev/2019-January/001786.html">Click here to read the original discussion on the lightning-dev mailing list</a>
        
        <p><i>Published on: 2019-01-03T15:35:01+00:00</i></p>
        <hr>
        <h3>Summary:</h3>
        <p>The possession of the payment preimage is considered sufficient proof of payment, regardless of what the receiver claims. However, reusing payment hashes should be strongly discouraged as it can lead to theft by intermediate routing nodes. ZmnSCPxj, a Bitcoin and Lightning Network contributor, clarified that if the receiver knows it does not control the entire Lightning Network, they should not reuse payment hashes. Andrea RASPITZU raised concerns about this issue and suggested that it should be made clear in BOLT11. A user contacted Anton Kumaigorodski claiming that they did not receive payment even though the payer was able to provide a preimage. It was discovered that the user reused the same invoice which had already expired. This incident raises concerns about QR reuse and calls for action. ZmnSCPxj stated that the possession of the payment preimage is considered sufficient proof of payment, regardless of what the receiver claims. However, the reuse of payment hashes should be strongly discouraged as it can lead to theft by intermediate routing nodes. Andrea RASPITZU suggested that there should be a warning in the spec regarding the reuse of payment_hash in invoices. The current BOLT11 example uses a donation invoice that seems to be "permanent" with a payment_hash that doesn't change after receiving a donation. Reusing known payment_hash is a security issue because an intermediary node routing a donation for the second time already knows the preimage, allowing it to pull the htlc from downstream without forwarding it to upstream. A malicious receiver could provide an invoice with assisted routes where among those they control a node, which won't forward to the htlc but instead steal the funds.</p>
        <hr>
        <p><i>Updated on: 2023-06-03T21:29:33.167167+00:00</i></p>
    

    

    <footer>
        <span style="font-family: Arial, Helvetica, sans-serif;">&#10084;&#65039;</span> <a href="https://chaincode.com" target="_blank" rel="noreferrer" style="text-decoration: none; color: inherit;">Chaincode</a>
    </footer>
</body>

</html>