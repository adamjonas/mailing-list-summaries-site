<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=us-ascii">
    <title>Atom Feed Display</title>
    <link rel="stylesheet" href="../../archive_styles.css">
</head>

<body BGCOLOR="#fffffb">
    
    <h1>Supporting a custodial user who wishes to withdraw all sats from the account... <span class="combined-summary">[combined summary]</span></h1>
    <hr class="solid">
    <br><b>Individual post summaries:</b>
    
        <ul>
            
                
                    <li>
                        <a href="/lightning-dev/Sept_2022/003678_Supporting-a-custodial-user-who-wishes-to-withdraw-all-sats-from-the-account-.html">Supporting a custodial user who wishes to withdraw all sats from the account...</a>
                        <b>ZmnSCPxj 2022-09-01 02:55:21+00:00</b>
                    </li>
                
                    <li>
                        <a href="/lightning-dev/Aug_2022/003677_Supporting-a-custodial-user-who-wishes-to-withdraw-all-sats-from-the-account-.html">Supporting a custodial user who wishes to withdraw all sats from the account...</a>
                        <b>Martin Habovštiak 2022-08-31 17:22:52+00:00</b>
                    </li>
                
                    <li>
                        <a href="/lightning-dev/Aug_2022/003675_Supporting-a-custodial-user-who-wishes-to-withdraw-all-sats-from-the-account-.html">Supporting a custodial user who wishes to withdraw all sats from the account...</a>
                        <b>ZmnSCPxj 2022-08-27 02:06:27+00:00</b>
                    </li>
                
                    <li>
                        <a href="/lightning-dev/Aug_2022/003674_Supporting-a-custodial-user-who-wishes-to-withdraw-all-sats-from-the-account-.html">Supporting a custodial user who wishes to withdraw all sats from the account...</a>
                        <b>René Pickhardt 2022-08-25 15:49:20+00:00</b>
                    </li>
                
            
        </ul>
        
            <a href="https://lists.linuxfoundation.org/pipermail/lightning-dev/2022-September/003678.html">Click here to read the original discussion on the lightning-dev mailing list</a>
        
        <p><i>Published on: 2022-09-01T02:55:21+00:00</i></p>
        <hr>
        <h3>Summary:</h3>
        <p>During a conversation between Martin and ZmnSCPxj, the issue of wallets not supporting the 'send max' feature when using a zero-amount invoice was brought up. Martin suggested that this could be due to the custodial service not implementing the feature. However, ZmnSCPxj pointed out that even if a solution is found, there is no guarantee that custodial services will actually implement it. They could also deceive users by claiming higher routing fees were paid. This raises concerns about the safety of funds in custodial services.On the Lightning-dev mailing list, a discussion took place regarding a problem faced by users of custodial wallets. These users were unable to withdraw the full amount from the service because the custodial service required a fee budget of 1%. This resulted in leftover amounts that repeated on the residual amount. To address this specific issue, a proposal called 'option_recipient_pays_routing_fees' was introduced. This proposal suggests adding a new flag in invoices to signal that the recipient is willing to pay for routing fees by releasing the preimage, even if the full amount has not been received in HTLCs. The workflow for this proposal involves creating an invoice with the flag and constructing the onion in a way that the first HTLC is for the full amount, while subsequent HTLCs decrease in value to ensure proper compensation for routing nodes. The recipient would release the preimage only if the missing sats are within a certain percentage. Additionally, it was suggested that trampoline routes could potentially solve this issue as well, where the receiver provides an encrypted route from a node to itself and deducts the fees from its received funds.The discussion also raised concerns about whether these proposed solutions can be enforced by custodial service providers. There is a possibility that they may refuse to implement them or even engage in theft if they are already custodial. It was noted that trampoline routes offer more control to the receiver, as they can specifically select the route. However, in the case of custodial services, the receiver cannot audit the route and determine the true fees. These concerns highlight the challenges in implementing and ensuring the effectiveness of such solutions when dealing with custodial services.In summary, a Lightning developer has proposed a solution called 'option_recipient_pays_routing_fees' to address the issue of users having leftover funds when withdrawing from custodial wallets. This proposal involves creating an invoice with a flag indicating that the recipient is willing to pay for routing fees by releasing the preimage, even if the full amount has not been received. Another potential solution is trampoline routes, where the receiver deducts the fees from its received funds. However, there are concerns about the implementation and enforcement of these solutions by custodial service providers. Additionally, educating users about the different invoice types may be a challenge, and input from the Bitcoin Design community could be valuable.</p>
        <hr>
        <p><i>Updated on: 2023-08-01T00:40:20.033992+00:00</i></p>
    

    

    <footer>
        <span style="font-family: Arial, Helvetica, sans-serif;">&#10084;&#65039;</span> <a href="https://chaincode.com" target="_blank" rel="noreferrer" style="text-decoration: none; color: inherit;">Chaincode</a>
    </footer>
</body>

</html>