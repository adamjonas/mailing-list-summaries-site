<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=us-ascii">
    <title>Atom Feed Display</title>
    <link rel="stylesheet" href="../../archive_styles.css">
</head>

<body BGCOLOR="#fffffb">
    
    <h1>Splice Lock Race Condition Solution</h1>
    <hr class="solid">
    
    <ul>
        
        
            <p><b>Author:</b> Dusty Daemon 2023-04-06 16:14:41
            <br><i>Published on: 2023-04-06T16:14:41+00:00</i></p>

        
        

        
        
        <li>
        <a href="/lightning-dev/April_2023/combined_Splice-Lock-Race-Condition-Solution.xml.html"> Combined Summary of all posts in thread </a>
        </li>
        
        <li>
            
                <a href="https://lists.linuxfoundation.org/pipermail/lightning-dev/2023-April/003905.html">Click here to read original discussion on the lightning-dev mailing list</a>
            
        </li>

    </ul>

    <hr>
    <h3> Summary:</h3>
    <p>The issue being discussed relates to the `announcement_signatures` and `commit_sig` cases. The solution involves storing the last_short_channel_id to determine which announcement messages can be safely ignored and which are considered errors until sending or receiving `revoke_and_ack`. Although it is not a protocol issue, it is a critical detail that implementations need to handle correctly to avoid breaking or force closing during the splice lock process. The proposal suggests allowing a certain class of 'stale' messages for a period of time until either mutual_splice_locked or successful commitment_signed/revoke_and_ack round trip in either direction. This ideal solution requires more effort but would make the protocol and nodes more robust. The link to the original gist from January is provided, along with a proposed solution that adds a lock on the connection via an extra STFU step.</p>
    <hr>
    <p><i> Updated on: 2023-06-03T12:32:36.528185+00:00 </i></p>
    
    

    <footer>
        <span style="font-family: Arial, Helvetica, sans-serif;">&#10084;&#65039;</span> <a href="https://chaincode.com" target="_blank" rel="noreferrer" style="text-decoration: none; color: inherit;">Chaincode</a>
    </footer>
</body>

</html>