<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=us-ascii">
    <title>Atom Feed Display</title>
    <link rel="stylesheet" href="../../archive_styles.css">
</head>

<body BGCOLOR="#fffffb">
    
    <h1>Potential vulnerability in Lightning backends: BOLT-11 &#34;payment hash&#34; does not commit to payment! <span class="combined-summary">[combined summary]</span></h1>
    <hr class="solid">
    <br><b>Individual post summaries:</b>
    
        <ul>
            
                
                    <li>
                        <a href="/lightning-dev/July_2023/004007_Potential-vulnerability-in-Lightning-backends-BOLT-11-payment-hash-does-not-commit-to-payment-.html">Potential vulnerability in Lightning backends: BOLT-11 &#34;payment hash&#34; does not commit to payment!</a>
                        <b>David A. Harding 2023-07-12 20:04:19+00:00</b>
                    </li>
                
                    <li>
                        <a href="/lightning-dev/July_2023/004006_Potential-vulnerability-in-Lightning-backends-BOLT-11-payment-hash-does-not-commit-to-payment-.html">Potential vulnerability in Lightning backends: BOLT-11 &#34;payment hash&#34; does not commit to payment!</a>
                        <b>callebtc  + 2023-07-06 07:22:59+00:00</b>
                    </li>
                
                    <li>
                        <a href="/lightning-dev/July_2023/004005_Potential-vulnerability-in-Lightning-backends-BOLT-11-payment-hash-does-not-commit-to-payment-.html">Potential vulnerability in Lightning backends: BOLT-11 &#34;payment hash&#34; does not commit to payment!</a>
                        <b>Rusty Russell  + 2023-07-06 07:10:42+00:00</b>
                    </li>
                
                    <li>
                        <a href="/lightning-dev/June_2023/003983_Potential-vulnerability-in-Lightning-backends-BOLT-11-payment-hash-does-not-commit-to-payment-.html">Potential vulnerability in Lightning backends: BOLT-11 &#34;payment hash&#34; does not commit to payment!</a>
                        <b>callebtc  + 2023-06-19 15:26:05+00:00</b>
                    </li>
                
                    <li>
                        <a href="/lightning-dev/June_2023/003986_Potential-vulnerability-in-Lightning-backends-BOLT-11-payment-hash-does-not-commit-to-payment-.html">Potential vulnerability in Lightning backends: BOLT-11 &#34;payment hash&#34; does not commit to payment!</a>
                        <b>Antoine Riard  + 2023-06-19 20:34:10+00:00</b>
                    </li>
                
            
        </ul>
        
            <a href="https://lists.linuxfoundation.org/pipermail/lightning-dev/2023-July/004007.html">Click here to read the original discussion on the lightning-dev mailing list</a>
        
        <p><i>Published on: 2023-07-12T20:04:19+00:00</i></p>
        <hr>
        <h3>Summary:</h3>
        <p>LNbits recently discovered an exploit that allows attackers to generate fraudulent balances by exploiting a vulnerability in how invoices are handled internally. The issue has been addressed in LNbits version 0.10.5, and users are advised to update their systems promptly. The team believes that similar exploits may be possible in other Lightning applications, particularly those involving custodial wallets, payment processors, and account management software.The attack involves inserting the payment hash of one payment into a different payment, creating a malicious invoice that tricks the backend into treating it as a legitimate payment. To carry out the attack, the attacker creates two invoices: A and B'. They then manipulate invoice B' by replacing its payment hash with the payment hash from invoice A, re-sign it, and serialize it again to create the malicious invoice B. The attacker creates a new account in LNbits and pays the malicious invoice B. The LNbits backend identifies the payment as internal and settles it by crediting invoice A and debiting invoice B, effectively creating a balance out of thin air.To mitigate this exploit, backends should use self-generated unique "checking ids" for internal payment lookups or implement additional checks to ensure that invoice details have not been tampered with. It is also important to note that payment hashes only commit to the preimage and not other payment details like the amount or pubkey.This incident highlights the sophistication of LN-savvy attackers who possess a deep understanding of bolt-11 and utilize custom tools to create malicious invoices. It also emphasizes the need to refer to the "payment hash" of an invoice as a "preimage" hash to avoid misconceptions about its commitment to payment details.Overall, it is essential for developers working on Lightning applications to implement robust security measures and remain vigilant about potential vulnerabilities in the handling of invoices.</p>
        <hr>
        <p><i>Updated on: 2023-07-14T02:37:21.662544+00:00</i></p>
    

    

    <footer>
        <span style="font-family: Arial, Helvetica, sans-serif;">&#10084;&#65039;</span> <a href="https://chaincode.com" target="_blank" rel="noreferrer" style="text-decoration: none; color: inherit;">Chaincode</a>
    </footer>
</body>

</html>