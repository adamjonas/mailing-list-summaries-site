<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=us-ascii">
    <title>Atom Feed Display</title>
    <link rel="stylesheet" href="../../archive_styles.css">
</head>

<body BGCOLOR="#fffffb">
    
    <h1>BIP proposal: Anti-fee-sniping protection with nSequence in taproot transactions to improve privacy for off-chain protocols</h1>
    <hr class="solid">
    
    <ul>
        
        
            <p><b>Author:</b> Chris Belcher 2021-07-22 14:44:11
            <br><i>Published on: 2021-07-22T14:44:11+00:00</i></p>

        
        

        
        
        <li>
            
                <a href="https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2021-July/019275.html">Click here to read original discussion on the bitcoin-dev mailing list</a>
            
        </li>

    </ul>

    <hr>
    <h3> Summary:</h3>
    <p>The author of the taproot privacy BIP proposal has written python-like pseudocode for clarification on the spec after receiving a review. The pseudocode implements the suggestion of choosing a random input instead of the first one. Wallet teams are already working on implementing taproot for their on-chain app, and the author urges wallet developers to include this BIP as well. This will improve the privacy and fungibility of off-chain protocols and will also improve the incentives for miners in the low-inflation future of Bitcoin. The pseudocode includes a function called "apply_anti_fee_sniping_fields" which sets the version of the transaction to 2 as required by bip68. If any of the transaction inputs have more confirmations than 65535 or are taproot inputs, it always sets nlocktime. Otherwise, it chooses either nlocktime or nsequence with 50% odds. If the condition is met, and randint(10) == 0, it sets transaction.nlocktime to max(0, transaction.nlocktime - randint(0, 99)). If not, it sets the input_index to randint(len(transaction.inputs)), and sets transaction.inputs[input_index].nsequence to transaction.inputs[input_index].confirmations(). If the condition is met, and randint(10) == 0, it sets transaction.inputs[input_index].nsequence to max(0, transaction.inputs[input_index].nsequence - randint(0, 99)). The latest version of the BIP can be found at <a href="https://gist.github.com/chris-belcher/903feab321bf41055c91eaec46581e89">https://gist.github.com/chris-belcher/903feab321bf41055c91eaec46581e89</a>.</p>
    <hr>
    <p><i> Updated on: 2023-05-21T03:20:37.429547+00:00 </i></p>
    
    

    <footer>
        <span style="font-family: Arial, Helvetica, sans-serif;">&#10084;&#65039;</span> <a href="https://chaincode.com" target="_blank" rel="noreferrer" style="text-decoration: none; color: inherit;">Chaincode</a>
    </footer>
</body>

</html>