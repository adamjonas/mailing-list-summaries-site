<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=us-ascii">
    <title>Atom Feed Display</title>
    <link rel="stylesheet" href="../../archive_styles.css">
</head>

<body BGCOLOR="#fffffb">
    
    <h1>Generalised Replay Protection for Future Hard Forks <span class="combined-summary">[combined summary]</span></h1>
    <hr class="solid">
    <br><b>Individual post summaries:</b>
    
        <ul>
            
                
                    <li>
                        <a href="/bitcoin-dev/Nov_2017/015269_Generalised-Replay-Protection-for-Future-Hard-Forks.html">Generalised Replay Protection for Future Hard Forks</a>
                        <b>Mats Jerratsch 2017-11-08 16:45:01</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/Nov_2017/015271_Generalised-Replay-Protection-for-Future-Hard-Forks.html">Generalised Replay Protection for Future Hard Forks</a>
                        <b>Jacob Eliosoff 2017-11-09 20:45:43</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/Nov_2017/015272_Generalised-Replay-Protection-for-Future-Hard-Forks.html">Generalised Replay Protection for Future Hard Forks</a>
                        <b>Sjors Provoost 2017-11-09 21:01:10</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/Nov_2017/015275_Generalised-Replay-Protection-for-Future-Hard-Forks.html">Generalised Replay Protection for Future Hard Forks</a>
                        <b>Mats Jerratsch 2017-11-10 11:28:06</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/Nov_2017/015282_Generalised-Replay-Protection-for-Future-Hard-Forks.html">Generalised Replay Protection for Future Hard Forks</a>
                        <b>Jacob Eliosoff 2017-11-13 15:31:55</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/Nov_2017/015290_Generalised-Replay-Protection-for-Future-Hard-Forks.html">Generalised Replay Protection for Future Hard Forks</a>
                        <b>Spartacus Rex 2017-11-13 17:02:07</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/Nov_2017/015291_Generalised-Replay-Protection-for-Future-Hard-Forks.html">Generalised Replay Protection for Future Hard Forks</a>
                        <b>Jacob Eliosoff 2017-11-15 05:02:48</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/Nov_2017/015258_Generalised-Replay-Protection-for-Future-Hard-Forks.html">Generalised Replay Protection for Future Hard Forks</a>
                        <b>Mats Jerratsch 2017-11-05 23:48:43</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/Nov_2017/015269_Generalised-Replay-Protection-for-Future-Hard-Forks.html">Generalised Replay Protection for Future Hard Forks</a>
                        <b>Mats Jerratsch 2017-11-08 16:45:01</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/Nov_2017/015272_Generalised-Replay-Protection-for-Future-Hard-Forks.html">Generalised Replay Protection for Future Hard Forks</a>
                        <b>Sjors Provoost 2017-11-09 21:01:10</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/Nov_2017/015282_Generalised-Replay-Protection-for-Future-Hard-Forks.html">Generalised Replay Protection for Future Hard Forks</a>
                        <b>Jacob Eliosoff 2017-11-13 15:31:55</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/Nov_2017/015290_Generalised-Replay-Protection-for-Future-Hard-Forks.html">Generalised Replay Protection for Future Hard Forks</a>
                        <b>Spartacus Rex 2017-11-13 17:02:07</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/Nov_2017/015291_Generalised-Replay-Protection-for-Future-Hard-Forks.html">Generalised Replay Protection for Future Hard Forks</a>
                        <b>Jacob Eliosoff 2017-11-15 05:02:48</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/Nov_2017/015275_Generalised-Replay-Protection-for-Future-Hard-Forks.html">Generalised Replay Protection for Future Hard Forks</a>
                        <b>Mats Jerratsch 2017-11-10 11:28:06</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/Nov_2017/015264_Generalised-Replay-Protection-for-Future-Hard-Forks.html">Generalised Replay Protection for Future Hard Forks</a>
                        <b>Jacob Eliosoff 2017-11-06 19:21:28</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/Nov_2017/015271_Generalised-Replay-Protection-for-Future-Hard-Forks.html">Generalised Replay Protection for Future Hard Forks</a>
                        <b>Jacob Eliosoff 2017-11-09 20:45:43</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/Nov_2017/015278_Generalised-Replay-Protection-for-Future-Hard-Forks.html">Generalised Replay Protection for Future Hard Forks</a>
                        <b>Jacob Eliosoff 2017-11-11 05:18:11</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/Nov_2017/015280_Generalised-Replay-Protection-for-Future-Hard-Forks.html">Generalised Replay Protection for Future Hard Forks</a>
                        <b>Mats Jerratsch 2017-11-13 10:03:04</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/Nov_2017/015258_Generalised-Replay-Protection-for-Future-Hard-Forks.html">Generalised Replay Protection for Future Hard Forks</a>
                        <b>Mats Jerratsch 2017-11-05 23:48:43</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/Nov_2017/015264_Generalised-Replay-Protection-for-Future-Hard-Forks.html">Generalised Replay Protection for Future Hard Forks</a>
                        <b>Jacob Eliosoff 2017-11-06 19:21:28</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/Nov_2017/015282_Generalised-Replay-Protection-for-Future-Hard-Forks.html">Generalised Replay Protection for Future Hard Forks</a>
                        <b>Jacob Eliosoff 2017-11-13 15:31:55</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/Nov_2017/015289_Generalised-Replay-Protection-for-Future-Hard-Forks.html">Generalised Replay Protection for Future Hard Forks</a>
                        <b>Mats Jerratsch 2017-11-14 13:49:56</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/Nov_2017/015291_Generalised-Replay-Protection-for-Future-Hard-Forks.html">Generalised Replay Protection for Future Hard Forks</a>
                        <b>Jacob Eliosoff 2017-11-15 05:02:48</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/Nov_2017/015275_Generalised-Replay-Protection-for-Future-Hard-Forks.html">Generalised Replay Protection for Future Hard Forks</a>
                        <b>Mats Jerratsch 2017-11-10 11:28:06</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/Nov_2017/015278_Generalised-Replay-Protection-for-Future-Hard-Forks.html">Generalised Replay Protection for Future Hard Forks</a>
                        <b>Jacob Eliosoff 2017-11-11 05:18:11</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/Nov_2017/015280_Generalised-Replay-Protection-for-Future-Hard-Forks.html">Generalised Replay Protection for Future Hard Forks</a>
                        <b>Mats Jerratsch 2017-11-13 10:03:04</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/Nov_2017/015289_Generalised-Replay-Protection-for-Future-Hard-Forks.html">Generalised Replay Protection for Future Hard Forks</a>
                        <b>Mats Jerratsch 2017-11-14 13:49:56</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/Nov_2017/015258_Generalised-Replay-Protection-for-Future-Hard-Forks.html">Generalised Replay Protection for Future Hard Forks</a>
                        <b>Mats Jerratsch 2017-11-05 23:48:43</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/Nov_2017/015264_Generalised-Replay-Protection-for-Future-Hard-Forks.html">Generalised Replay Protection for Future Hard Forks</a>
                        <b>Jacob Eliosoff 2017-11-06 19:21:28</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/Nov_2017/015289_Generalised-Replay-Protection-for-Future-Hard-Forks.html">Generalised Replay Protection for Future Hard Forks</a>
                        <b>Mats Jerratsch 2017-11-14 13:49:56</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/Nov_2017/015269_Generalised-Replay-Protection-for-Future-Hard-Forks.html">Generalised Replay Protection for Future Hard Forks</a>
                        <b>Mats Jerratsch 2017-11-08 16:45:01</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/Nov_2017/015271_Generalised-Replay-Protection-for-Future-Hard-Forks.html">Generalised Replay Protection for Future Hard Forks</a>
                        <b>Jacob Eliosoff 2017-11-09 20:45:43</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/Nov_2017/015272_Generalised-Replay-Protection-for-Future-Hard-Forks.html">Generalised Replay Protection for Future Hard Forks</a>
                        <b>Sjors Provoost 2017-11-09 21:01:10</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/Nov_2017/015278_Generalised-Replay-Protection-for-Future-Hard-Forks.html">Generalised Replay Protection for Future Hard Forks</a>
                        <b>Jacob Eliosoff 2017-11-11 05:18:11</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/Nov_2017/015280_Generalised-Replay-Protection-for-Future-Hard-Forks.html">Generalised Replay Protection for Future Hard Forks</a>
                        <b>Mats Jerratsch 2017-11-13 10:03:04</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/Nov_2017/015290_Generalised-Replay-Protection-for-Future-Hard-Forks.html">Generalised Replay Protection for Future Hard Forks</a>
                        <b>Spartacus Rex 2017-11-13 17:02:07</b>
                    </li>
                
            
        </ul>
        
            <a href="https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2017-November/015269.html">Click here to read the original discussion on the bitcoin-dev mailing list</a>
        
        <p><i>Published on: 2017-11-08T16:45:01+00:00</i></p>
        <hr>
        <h3>Summary:</h3>
        <p>The email exchange discusses a proposal to implement replay protection and fork-specific addresses in the Bitcoin protocol to standardize replay protection across different forks, which is currently done on an ad-hoc basis. The proposed schema assigns a unique `nForkId` to each hard fork, which is appended to the final template when preparing a transaction for signing or validation, and payment addresses will also contain the fork id, allowing wallets to parse the address and display which token the user is about to spend. The proposal aims to prevent ad-hoc replay protection built within days with little review or no replay protection at all during hard forks. This proposal advocates the notion of non-hostile forks by giving any hard fork a unique incremented id called `nForkId`. Users are protected against accidentally sending coins on the wrong chain through the introduction of a fork-specific incompatible address space. The coin/token type is encoded in the address itself, enforcing the idea of validating the payment under the rules chosen by the payee.For light clients, the `nForkId` can be enforced in the coinbase/block header, or a new P2P message type can be introduced for sending transactions. The proposal suggests allowing signatures with `nForkId=1` through a soft fork by incrementing the script version of SegWit. The proposal also enables wallets to distinguish between different tokens, which can lead to different implementations by developers.However, the discussion also highlights potential pitfalls in using nForkId, such as transactions being valid not only on future forks but also on past forks. It's essential to protect the funding transaction to avoid replay attacks on past forks by setting `nForkId>=1`. For commitment transactions, `nForkId=0` can be used, making it valid on all chains, but users should note that the parent transaction exists only on two chains, the original one and the forked one. The proposal faces a dilemma where an LN commitment transaction either has to be given the specific 'nForkId' of the fork it's created on or be given 'nForkId 0,' which has a flaw. To avoid this dilemma, it may make sense to incorporate Luke's OP_CHECKBLOCKATHEIGHT and make the fork ID a (block height, hash) pair rather than just a number. Additionally, using solutions like SIGHASH_BLOCKCOMMIT could be superior in making transactions difficult to circumvent. Overall, the proposed solution provides a comprehensive approach to replay protection during hard forks and encourages developers to incorporate fork IDs into new address formats. It is important to consider the potential pitfalls of nForkId and ensure proper protection of funding transactions to avoid replay attacks on past forks.The use of the `nForkId` value to protect transactions in forks is a topic of discussion among experts. While this method has been used successfully in some cases, there are concerns that it may miss certain cases due to forks forming a partial order while IDs form a total order. The discussion also delves into the nForkId values for Lightning Network (LN) transactions, where the funding transaction requires protection by setting `nForkId>=1`, while the commitment transaction should have `nForkId=0`. This ensures that the payment channel is non-existent on any past forks and valid on all chains for future forks. However, using `nForkId 0` for LN transactions can lead to potential pitfalls as it could be valid not only for future forks but also on past ones. It's important to keep these factors in mind when considering the use of `nForkId` values to protect transactions. The proposal also presents a way to prevent 'mis-sends' by encoding the coin/token type in the address itself, making mis-sends fundamentally impossible.</p>
        <hr>
        <p><i>Updated on: 2023-06-12T22:05:08.363418+00:00</i></p>
    

    

    <footer>
        <span style="font-family: Arial, Helvetica, sans-serif;">&#10084;&#65039;</span> <a href="https://chaincode.com" target="_blank" rel="noreferrer" style="text-decoration: none; color: inherit;">Chaincode</a>
    </footer>
</body>

</html>