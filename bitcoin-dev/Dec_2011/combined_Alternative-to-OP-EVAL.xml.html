<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=us-ascii">
    <title>Atom Feed Display</title>
    <link rel="stylesheet" href="../../archive_styles.css">
</head>

<body BGCOLOR="#fffffb">
    
    <h1>Alternative to OP_EVAL <span class="combined-summary">[combined summary]</span></h1>
    <hr class="solid">
    <br><b>Individual post summaries:</b>
    
    <ul>
        
        
        <li>
        <a href="/bitcoin-dev/Dec_2011/001006_Alternative-to-OP-EVAL.xml.html">Alternative to OP_EVAL</a>
        <b>Pieter Wuille 2011-12-29 21:00:26</b>
        </li>
        
        <li>
        <a href="/bitcoin-dev/Dec_2011/001004_Alternative-to-OP-EVAL.xml.html">Alternative to OP_EVAL</a>
        <b>Pieter Wuille 2011-12-29 19:08:39</b>
        </li>
        

        
    </ul>
    
        <a href="https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2011-December/001006.html">Click here to read original discussion on the bitcoin-dev mailing list</a>
    
    <p><i>Published on: 2011-12-29T21:00:26+00:00</i></p>
    <hr>
    <h3> Summary:</h3>
    <p>Pieter Wuille proposed an alternative to OP_EVAL called OP_CHECKEDEVAL in response to roconnor's proposal for OP_CODEHASH, with the aim of achieving the same properties as OP_EVAL while being more backward-compatible. The new proposal restricts OP_EVAL by not touching the stack or altstack, and instead executes its subscript in an independent environment that only inherits the main stack. This allows the outer script to hide information from the inner script. OP_EVAL is an effective no-op for the execution state of the outer script except for potentially causing failure, popping an element from the literal-only stack, and looking at the last (code-position wise) literal pushed on the stack and using it as a script to be executed.A pay-to-script-hash becomes "OP_EVAL OP_HASH160 OP_EQUAL" and is redeemed using "[script input] >". The proposed OP_CHECKEDEVAL looks at the two elements most recently pushed by a literal, S (the serialized script) and H (its hash), which implies it defines its own literal-only stack where all literals push to and only OP_CHECKEDEVAL pops from. For the outer script, OP_CHECKEDEVAL has no effect except for 2 elements popped from the literal-only stack and potentially causing failure. It does not touch the main stack, alt stack, or any other part of the execution state not listed above. Failure occurs when either of three conditions hold: no two elements remain on the literal-only stack, the Hash(S) != H, or the inner script execution caused failure. For the execution of the inner script, it is executed in a completely new and independent execution environment, executing the deserialized S and inheriting the main stack and alt stack without the serialized script and the hash themselves from the outer execution. The proposal requires OP_CHECKEDEVAL to immediately follow the push of script and hash so that the code in the pair OP_CHECKEDEVAL > can be parsed and interpreted as code, allowing static analysis. As OP_CHECKEDEVAL has no effects except for potentially causing failure, it is very similar to the OP_NOPx it would replace and guarantees that interpreting OP_CHECKEDEVAL as OP_NOPx can never cause the script to become invalid if it wasn't already.A basic pay-to-script-hash scriptPubKey is very short: "OP_CHECKEDEVAL". It is redeemed using an empty stack. The implementation is very similar to what was already done for OP_EVAL, with EvalScriptInner needing less by-ref arguments as it cannot modify the parent's state and a literal-only stack needing to be maintained. The proposed OP_CHECKEDEVAL combines all advantages of being easy to spend-to-script-hash (shorter than OP_EVAL), backward-compatible (guaranteed by construction, instead of separately enforced like with OP_EVAL), statically analyzable (though it requires deserializing the script data), and possibility to introduce a new language inside (not done in this proposal). Only disadvantages are being slightly less flexible than OP_EVAL as it disallows dynamic interaction with serialized scripts and requiring static code analyzers to deserialize script data. Credits go to gmaxwell for the idea of a literal-only stack.</p>
    <hr>
    <p><i> Updated on: 2023-05-18T23:29:17.287316+00:00 </i></p>
    

    

    <footer>
        <span style="font-family: Arial, Helvetica, sans-serif;">&#10084;&#65039;</span> <a href="https://chaincode.com" target="_blank" rel="noreferrer" style="text-decoration: none; color: inherit;">Chaincode</a>
    </footer>
</body>

</html>