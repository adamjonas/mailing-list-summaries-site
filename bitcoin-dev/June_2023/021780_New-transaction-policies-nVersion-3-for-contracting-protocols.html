<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=us-ascii">
    <title>Atom Feed Display</title>
    <link rel="stylesheet" href="../../archive_styles.css">
</head>

<body BGCOLOR="#fffffb">
    
    <h1>New transaction policies (nVersion=3) for contracting protocols</h1>
    <hr class="solid">
    
    <ul>
        
        
            <p><b>Author:</b> Greg Sanders 2023-06-21 20:57:45+00:00
            <br><i>Published on: 2023-06-21T20:57:45+00:00</i></p>

        
        

        
        
        <li>
        <a href="/bitcoin-dev/June_2023/combined_New-transaction-policies-nVersion-3-for-contracting-protocols.html"> Combined Summary of all posts in thread </a>
        </li>
        
        <li>
            
                <a href="https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2023-June/021780.html">Click here to read original discussion on the bitcoin-dev mailing list</a>
            
        </li>

    </ul>

    <hr>
    <h3> Summary:</h3>
    <p>The proposal aims to solve the problem of Rule 3 pinning and eliminate the need for CPFP carve-out by implementing a set of mempool/transaction relay policies. These policies include additional rules for V3 transactions and modifications to package RBF rules.For V3 transactions, there are specific rules in addition to the existing standardness rules. Firstly, a V3 transaction can be replaced even if it does not signal BIP125 replaceability, as long as it meets other RBF rules. This allows for inherited replaceability signaling when creating descendants of unconfirmed transactions. Another rule is that an unconfirmed V3 transaction cannot have more than one descendant to prevent a pinning attack. However, at least one descendant is required to allow CPFP of the presigned transaction. Additionally, a V3 transaction with an unconfirmed V3 ancestor cannot exceed 1000 virtual bytes in size to manage transaction size and fees.The package RBF rules also undergo modifications. One modification is that a package may include new unconfirmed inputs, but the ancestor feerate of the child must be at least as high as the ancestor feerate of the parent to ensure sufficient fees are paid. These proposed policies aim to improve the replaceability and fee-bumping capabilities of transactions, particularly for L2/contract protocols. The implementation has been done in Bitcoin Core, and user feedback is encouraged to identify any pinning attacks or usability issues.Another proposal suggests modifying the Bitcoin transaction replacement rules. The new rule states that the minimum between the package feerate and ancestor feerate of the child should not be lower than the individual feerates of all directly conflicting transactions and the ancestor feerates of all original transactions. This change aims to ensure that replacement transactions are not less incentive-compatible to mine. By using the minimum between the package feerate and ancestor feerate of the child, a more conservative approach is taken.A new rule is introduced requiring all package transactions with mempool conflicts to be V3. This means that the "sponsoring" child transaction must also be V3. This change limits the type of packages to child-with-parents packages, making it easier to apply fee-related rules correctly.For LN usage, commitment transactions should be V3 and have 1 anchor output. These commitment transactions can be signed with 0 fees or 1 sat/vbyte once package relay is deployed on a significant portion of the network. If the commitment transaction needs to be broadcasted, the desired feerate at broadcast time should be determined, and the anchor output should be spent in a high feerate transaction. The child transaction that bumps the fees must also be V3 and should not exceed 1000vB. Unconfirmed V3 transactions should never be spent from due to restrictive descendant limits.These changes address the issue of Rule 3 Pinning and provide a solution that restricts both the user and the counterparty. Fee-bumping a counterparty's commitment transaction using CPFP is no longer necessary. Instead, a high-feerate child transaction can be attached to the user's commitment transaction.The introduction of V3 transactions does not pose a privacy issue as they are unlikely to be widely used outside of the Lightning Network. Unilateral closes are already identifiable LN transactions, and for cooperative closes and opens, it makes sense to continue using V2 transactions. Therefore, the use of V3 transactions should not worsen the privacy situation.V3 transactions that do not signal BIP125 replaceability are indeed replaceable. This is not a backward compatibility issue since under the previous policy, a V3 transaction would not have been in the mempool.It is possible for a V2 transaction to replace a V3 transaction and vice versa. However, if the original V3 transaction has an unconfirmed V3 parent, this would violate the "inherited V3" rule and would be rejected.Feedback and review on these proposed changes are welcome. More detailed information can be found in the provided links [1] [2].</p>
    <hr>
    <p><i> Updated on: 2023-07-13T02:36:30.857807+00:00 </i></p>
    
    

    <footer>
        <span style="font-family: Arial, Helvetica, sans-serif;">&#10084;&#65039;</span> <a href="https://chaincode.com" target="_blank" rel="noreferrer" style="text-decoration: none; color: inherit;">Chaincode</a>
    </footer>
</body>

</html>