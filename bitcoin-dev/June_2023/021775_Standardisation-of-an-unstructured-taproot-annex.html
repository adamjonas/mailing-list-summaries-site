<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=us-ascii">
    <title>Atom Feed Display</title>
    <link rel="stylesheet" href="../../archive_styles.css">
</head>

<body BGCOLOR="#fffffb">
    
    <h1>Standardisation of an unstructured taproot annex</h1>
    <hr class="solid">
    
    <ul>
        
        
            <p><b>Author:</b> Antoine Riard 2023-06-18 20:32:12+00:00
            <br><i>Published on: 2023-06-18T20:32:12+00:00</i></p>

        
        

        
        
        <li>
        <a href="/bitcoin-dev/June_2023/combined_Standardisation-of-an-unstructured-taproot-annex.html"> Combined Summary of all posts in thread </a>
        </li>
        
        <li>
            
                <a href="https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2023-June/021775.html">Click here to read original discussion on the bitcoin-dev mailing list</a>
            
        </li>

    </ul>

    <hr>
    <h3> Summary:</h3>
    <p>There is a discussion among developers regarding the implementation of an opt-in annex in Bitcoin transactions. The opt-in annex would require every input to commit to an annex, even if it is empty. This measure is intended to ensure that existing multi-party protocols remain unaffected. However, there are concerns about how this would impact current Taproot support on the Lightning side, as all P2TR spends would need to add an annex and commit to it in the BIP341 signature digest. Failure to do so could break propagations of `option_taproot` channel transactions.Another approach being considered is limiting the maximum size/weight of the witness/transaction to 256 bytes. This is seen as a way to protect opt-in users. There is a branch in development that implements this approach, along with the "only allow tlv record 0" using the TLV format from BIP #1381.In response to these proposals, Greg Sanders suggests that introducing the maximum size/weight of the transaction as a TLV record would be a reasonable starting point. He believes this approach would not unduly impact current users and can be relaxed in the future by using max tx size policy "hints" in an annex field.Joost Jager provides a summary of the most restrictive policy that would still enable annex-vaults and aligns with previous work done. The proposed policy includes the opt-in annex requirement, the use of the TLV format defined in BIP #1381, allowing only unstructured data in tlv record 0 for future extensibility, and limiting the maximum size of the value to 256 bytes to protect opt-in users.However, Joost notes that the current limit of 126 bytes in a related pull request is insufficient for certain types of vaults. He explains that if there are two presigned transactions (unvault and emergency), those signatures alone would take up 128 bytes. Additionally, 32 bytes would be needed to store the ephemeral key itself. Joost suggests that increasing the limit to accommodate these requirements would be necessary.The discussion remains open for further input from other developers.Overall, the conversation revolves around implementing an opt-in annex in Bitcoin transactions and finding ways to protect opt-in users while ensuring compatibility with existing protocols. The proposed solutions involve modifying Taproot support on the Lightning side and introducing limits on the size/weight of the transaction.</p>
    <hr>
    <p><i> Updated on: 2023-07-06T02:44:45.538333+00:00 </i></p>
    
    

    <footer>
        <span style="font-family: Arial, Helvetica, sans-serif;">&#10084;&#65039;</span> <a href="https://chaincode.com" target="_blank" rel="noreferrer" style="text-decoration: none; color: inherit;">Chaincode</a>
    </footer>
</body>

</html>