<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=us-ascii">
    <title>Atom Feed Display</title>
    <link rel="stylesheet" href="../../archive_styles.css">
</head>

<body BGCOLOR="#fffffb">
    
    <h1>Standardisation of an unstructured taproot annex</h1>
    <hr class="solid">
    
    <ul>
        
        
            <p><b>Author:</b> Antoine Riard 2023-06-18 20:32:12+00:00
            <br><i>Published on: 2023-06-18T20:32:12+00:00</i></p>

        
        

        
        
        <li>
        <a href="/bitcoin-dev/June_2023/combined_Standardisation-of-an-unstructured-taproot-annex.html"> Combined Summary of all posts in thread </a>
        </li>
        
        <li>
            
                <a href="https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2023-June/021775.html">Click here to read original discussion on the bitcoin-dev mailing list</a>
            
        </li>

    </ul>

    <hr>
    <h3> Summary:</h3>
    <p>The discussion thread begins with a proposal to require every input to commit to an annex, even if it is empty, in order to ensure that existing multi-party protocols remain unaffected. This would potentially impact the current Taproot support on the Lightning-side, as all P2TR spends would need to add an annex and commit to it in the BIP341 signature digest. It is noted that this would be a mandatory upgrade for Lightning nodes to avoid breaking propagations of their `option_taproot` channel transactions.Another approach suggested is to introduce a TLV record that limits the maximum size/weight of the witness/transaction. A branch implementing this approach can be found at: <a href="https://github.com/bitcoin-inquisition/bitcoin/pull/28">https://github.com/bitcoin-inquisition/bitcoin/pull/28</a>. This branch also implements the "only allow tlv record 0" with the TLV format from BIP #1381.In response to the proposal, Greg Sanders mentions that using the TLV format seems reasonable and simple from an accounting perspective. He suggests that the maximum size policy could be further relaxed in the future by using max tx size policy "hints" in an annex field.Joost Jager responds to Greg's suggestion and presents a more restrictive policy that would still enable annex-vaults while protecting opt-in users. The proposed policy includes the following elements: opt-in annex (every input must commit to an annex even if it is empty), Tlv format as defined in <a href="https://github.com/bitcoin/bips/pull/1381,">https://github.com/bitcoin/bips/pull/1381,</a> only allowing tlv record 0 for unstructured data, and limiting the maximum size of the value to 256 bytes to protect opt-in users. However, Joost points out that the existing limit of 126 bytes in another pull request (<a href="https://github.com/bitcoin-inquisition/bitcoin/pull/22)">https://github.com/bitcoin-inquisition/bitcoin/pull/22)</a> is insufficient for these types of vaults, as there may be multiple presigned transactions that require additional space.Overall, the discussion revolves around ensuring compatibility with existing protocols, introducing an opt-in annex requirement, and limiting the size of values to protect users. The use of TLV format is considered as a potential solution, and further discussions are expected to address practical objections and refine the proposed policies.</p>
    <hr>
    <p><i> Updated on: 2023-07-07T02:36:20.864688+00:00 </i></p>
    
    

    <footer>
        <span style="font-family: Arial, Helvetica, sans-serif;">&#10084;&#65039;</span> <a href="https://chaincode.com" target="_blank" rel="noreferrer" style="text-decoration: none; color: inherit;">Chaincode</a>
    </footer>
</body>

</html>