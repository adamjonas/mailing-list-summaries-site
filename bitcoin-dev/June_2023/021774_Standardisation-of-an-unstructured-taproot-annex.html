<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=us-ascii">
    <title>Atom Feed Display</title>
    <link rel="stylesheet" href="../../archive_styles.css">
</head>

<body BGCOLOR="#fffffb">
    
    <h1>Standardisation of an unstructured taproot annex</h1>
    <hr class="solid">
    
    <ul>
        
        
            <p><b>Author:</b> Greg Sanders 2023-06-18 20:40:53+00:00
            <br><i>Published on: 2023-06-18T20:40:53+00:00</i></p>

        
        

        
        
        <li>
        <a href="/bitcoin-dev/June_2023/combined_Standardisation-of-an-unstructured-taproot-annex.html"> Combined Summary of all posts in thread </a>
        </li>
        
        <li>
            
                <a href="https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2023-June/021774.html">Click here to read original discussion on the bitcoin-dev mailing list</a>
            
        </li>

    </ul>

    <hr>
    <h3> Summary:</h3>
    <p>Antoine Riard proposed an idea regarding the Taproot upgrade on the Lightning-side, where all P2TR spends must add an annex and commit to it in the BIP341 signature digest. Greg Sanders requested a citation for this information, as he believes that protocols should not be built on undeveloped upgrade hooks. Antoine clarified that requiring every input to commit to an annex, even if it is empty, would require modifying current Taproot support on the Lightning-side. This mandatory upgrade for Lightning nodes is necessary to ensure the propagation of their `option_taproot` channel transactions.Another approach to protect opt-in users is by limiting the maximum size of the value to 256 bytes. There is a branch that implements this approach as a TLV record itself, which can be found at <a href="https://github.com/bitcoin-inquisition/bitcoin/pull/28">https://github.com/bitcoin-inquisition/bitcoin/pull/28</a>. This branch also includes the implementation of "only allow tlv record 0" with the TLV format from BIPs #1381.Greg Sanders mentioned that the TLV format seems like a reasonable place to start, as it wouldn't unduly impact current users and is simple from an accounting perspective. He suggests that the maximum size of the annex could be further relaxed in the future by using max tx size policy "hints" in an annex field.Joost Jager discussed the most restrictive policy that would enable annex-vaults and align with existing work. This policy includes an opt-in annex, a Tlv format as defined in <a href="https://github.com/bitcoin/bips/pull/1381,">https://github.com/bitcoin/bips/pull/1381,</a> only allowing tlv record 0 for unstructured data, and limiting the maximum size of the value to 256 bytes. However, Joost pointed out that the limit of 126 bytes proposed in <a href="https://github.com/bitcoin-inquisition/bitcoin/pull/22">https://github.com/bitcoin-inquisition/bitcoin/pull/22</a> is insufficient for these types of vaults. Joost asked for any remaining practical objections to making the annex standard under the listed conditions.Overall, there is a discussion about the Taproot upgrade and its impact on Lightning nodes. The proposal includes requiring all P2TR spends to add an annex and commit to it in the BIP341 signature digest. Additionally, there is a suggestion to limit the maximum size of the value to 256 bytes for the protection of opt-in users. Various branches and BIPs are referenced throughout the conversation for further information.</p>
    <hr>
    <p><i> Updated on: 2023-07-08T02:34:54.224060+00:00 </i></p>
    
    

    <footer>
        <span style="font-family: Arial, Helvetica, sans-serif;">&#10084;&#65039;</span> <a href="https://chaincode.com" target="_blank" rel="noreferrer" style="text-decoration: none; color: inherit;">Chaincode</a>
    </footer>
</body>

</html>