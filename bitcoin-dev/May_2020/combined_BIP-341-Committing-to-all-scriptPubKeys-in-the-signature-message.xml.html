<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=us-ascii">
    <title>Atom Feed Display</title>
    <link rel="stylesheet" href="../../archive_styles.css">
</head>

<body BGCOLOR="#fffffb">
    
    <h1>BIP-341: Committing to all scriptPubKeys in the signature message <span class="combined-summary">[combined summary]</span></h1>
    <hr class="solid">
    <br><b>Individual post summaries:</b>
    
        <ul>
            
                
                    <li>
                        <a href="/bitcoin-dev/May_2020/017807_BIP-341-Committing-to-all-scriptPubKeys-in-the-signature-message.xml.html">BIP-341: Committing to all scriptPubKeys in the signature message</a>
                        <b>Andrew Kozlik 2020-05-01 08:48:41</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/May_2020/017809_BIP-341-Committing-to-all-scriptPubKeys-in-the-signature-message.xml.html">BIP-341: Committing to all scriptPubKeys in the signature message</a>
                        <b>Greg Sanders 2020-05-01 12:25:53</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/May_2020/017810_BIP-341-Committing-to-all-scriptPubKeys-in-the-signature-message.xml.html">BIP-341: Committing to all scriptPubKeys in the signature message</a>
                        <b>Jeremy 2020-05-02 04:35:41</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/May_2020/017811_BIP-341-Committing-to-all-scriptPubKeys-in-the-signature-message.xml.html">BIP-341: Committing to all scriptPubKeys in the signature message</a>
                        <b>David A. Harding 2020-05-02 12:53:12</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/May_2020/017812_BIP-341-Committing-to-all-scriptPubKeys-in-the-signature-message.xml.html">BIP-341: Committing to all scriptPubKeys in the signature message</a>
                        <b>Russell O&#39;Connor 2020-05-02 14:43:13</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/May_2020/017817_BIP-341-Committing-to-all-scriptPubKeys-in-the-signature-message.xml.html">BIP-341: Committing to all scriptPubKeys in the signature message</a>
                        <b>Andrew Kozlik 2020-05-04 15:48:00</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/May_2020/017805_BIP-341-Committing-to-all-scriptPubKeys-in-the-signature-message.xml.html">BIP-341: Committing to all scriptPubKeys in the signature message</a>
                        <b>Jeremy 2020-05-01 06:57:09</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/May_2020/017807_BIP-341-Committing-to-all-scriptPubKeys-in-the-signature-message.xml.html">BIP-341: Committing to all scriptPubKeys in the signature message</a>
                        <b>Andrew Kozlik 2020-05-01 08:48:41</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/May_2020/017814_BIP-341-Committing-to-all-scriptPubKeys-in-the-signature-message.xml.html">BIP-341: Committing to all scriptPubKeys in the signature message</a>
                        <b>Russell O&#39;Connor 2020-05-02 21:15:51</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/May_2020/017817_BIP-341-Committing-to-all-scriptPubKeys-in-the-signature-message.xml.html">BIP-341: Committing to all scriptPubKeys in the signature message</a>
                        <b>Andrew Kozlik 2020-05-04 15:48:00</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/May_2020/017805_BIP-341-Committing-to-all-scriptPubKeys-in-the-signature-message.xml.html">BIP-341: Committing to all scriptPubKeys in the signature message</a>
                        <b>Jeremy 2020-05-01 06:57:09</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/May_2020/017808_BIP-341-Committing-to-all-scriptPubKeys-in-the-signature-message.xml.html">BIP-341: Committing to all scriptPubKeys in the signature message</a>
                        <b>Russell O&#39;Connor 2020-05-01 12:23:07</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/May_2020/017809_BIP-341-Committing-to-all-scriptPubKeys-in-the-signature-message.xml.html">BIP-341: Committing to all scriptPubKeys in the signature message</a>
                        <b>Greg Sanders 2020-05-01 12:25:53</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/May_2020/017810_BIP-341-Committing-to-all-scriptPubKeys-in-the-signature-message.xml.html">BIP-341: Committing to all scriptPubKeys in the signature message</a>
                        <b>Jeremy 2020-05-02 04:35:41</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/May_2020/017811_BIP-341-Committing-to-all-scriptPubKeys-in-the-signature-message.xml.html">BIP-341: Committing to all scriptPubKeys in the signature message</a>
                        <b>David A. Harding 2020-05-02 12:53:12</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/May_2020/017812_BIP-341-Committing-to-all-scriptPubKeys-in-the-signature-message.xml.html">BIP-341: Committing to all scriptPubKeys in the signature message</a>
                        <b>Russell O&#39;Connor 2020-05-02 14:43:13</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/April_2020/017801_BIP-341-Committing-to-all-scriptPubKeys-in-the-signature-message.xml.html">BIP-341: Committing to all scriptPubKeys in the signature message</a>
                        <b>Andrew Kozlik 2020-04-29 14:57:46</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/May_2020/017849_BIP-341-Committing-to-all-scriptPubKeys-in-the-signature-message.xml.html">BIP-341: Committing to all scriptPubKeys in the signature message</a>
                        <b>Pieter Wuille 2020-05-11 22:12:33</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/May_2020/017809_BIP-341-Committing-to-all-scriptPubKeys-in-the-signature-message.xml.html">BIP-341: Committing to all scriptPubKeys in the signature message</a>
                        <b>Greg Sanders 2020-05-01 12:25:53</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/May_2020/017811_BIP-341-Committing-to-all-scriptPubKeys-in-the-signature-message.xml.html">BIP-341: Committing to all scriptPubKeys in the signature message</a>
                        <b>David A. Harding 2020-05-02 12:53:12</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/May_2020/017812_BIP-341-Committing-to-all-scriptPubKeys-in-the-signature-message.xml.html">BIP-341: Committing to all scriptPubKeys in the signature message</a>
                        <b>Russell O&#39;Connor 2020-05-02 14:43:13</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/May_2020/017819_BIP-341-Committing-to-all-scriptPubKeys-in-the-signature-message.xml.html">BIP-341: Committing to all scriptPubKeys in the signature message</a>
                        <b>Jonas Nick 2020-05-05 10:20:18</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/May_2020/017849_BIP-341-Committing-to-all-scriptPubKeys-in-the-signature-message.xml.html">BIP-341: Committing to all scriptPubKeys in the signature message</a>
                        <b>Pieter Wuille 2020-05-11 22:12:33</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/May_2020/017808_BIP-341-Committing-to-all-scriptPubKeys-in-the-signature-message.xml.html">BIP-341: Committing to all scriptPubKeys in the signature message</a>
                        <b>Russell O&#39;Connor 2020-05-01 12:23:07</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/May_2020/017814_BIP-341-Committing-to-all-scriptPubKeys-in-the-signature-message.xml.html">BIP-341: Committing to all scriptPubKeys in the signature message</a>
                        <b>Russell O&#39;Connor 2020-05-02 21:15:51</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/May_2020/017819_BIP-341-Committing-to-all-scriptPubKeys-in-the-signature-message.xml.html">BIP-341: Committing to all scriptPubKeys in the signature message</a>
                        <b>Jonas Nick 2020-05-05 10:20:18</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/May_2020/017807_BIP-341-Committing-to-all-scriptPubKeys-in-the-signature-message.xml.html">BIP-341: Committing to all scriptPubKeys in the signature message</a>
                        <b>Andrew Kozlik 2020-05-01 08:48:41</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/May_2020/017814_BIP-341-Committing-to-all-scriptPubKeys-in-the-signature-message.xml.html">BIP-341: Committing to all scriptPubKeys in the signature message</a>
                        <b>Russell O&#39;Connor 2020-05-02 21:15:51</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/May_2020/017808_BIP-341-Committing-to-all-scriptPubKeys-in-the-signature-message.xml.html">BIP-341: Committing to all scriptPubKeys in the signature message</a>
                        <b>Russell O&#39;Connor 2020-05-01 12:23:07</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/May_2020/017810_BIP-341-Committing-to-all-scriptPubKeys-in-the-signature-message.xml.html">BIP-341: Committing to all scriptPubKeys in the signature message</a>
                        <b>Jeremy 2020-05-02 04:35:41</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/May_2020/017813_BIP-341-Committing-to-all-scriptPubKeys-in-the-signature-message.xml.html">BIP-341: Committing to all scriptPubKeys in the signature message</a>
                        <b>Anthony Towns 2020-05-02 14:26:02</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/April_2020/017801_BIP-341-Committing-to-all-scriptPubKeys-in-the-signature-message.xml.html">BIP-341: Committing to all scriptPubKeys in the signature message</a>
                        <b>Andrew Kozlik 2020-04-29 14:57:46</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/May_2020/017805_BIP-341-Committing-to-all-scriptPubKeys-in-the-signature-message.xml.html">BIP-341: Committing to all scriptPubKeys in the signature message</a>
                        <b>Jeremy 2020-05-01 06:57:09</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/May_2020/017813_BIP-341-Committing-to-all-scriptPubKeys-in-the-signature-message.xml.html">BIP-341: Committing to all scriptPubKeys in the signature message</a>
                        <b>Anthony Towns 2020-05-02 14:26:02</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/April_2020/017801_BIP-341-Committing-to-all-scriptPubKeys-in-the-signature-message.xml.html">BIP-341: Committing to all scriptPubKeys in the signature message</a>
                        <b>Andrew Kozlik 2020-04-29 14:57:46</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/May_2020/017813_BIP-341-Committing-to-all-scriptPubKeys-in-the-signature-message.xml.html">BIP-341: Committing to all scriptPubKeys in the signature message</a>
                        <b>Anthony Towns 2020-05-02 14:26:02</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/May_2020/017817_BIP-341-Committing-to-all-scriptPubKeys-in-the-signature-message.xml.html">BIP-341: Committing to all scriptPubKeys in the signature message</a>
                        <b>Andrew Kozlik 2020-05-04 15:48:00</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/May_2020/017819_BIP-341-Committing-to-all-scriptPubKeys-in-the-signature-message.xml.html">BIP-341: Committing to all scriptPubKeys in the signature message</a>
                        <b>Jonas Nick 2020-05-05 10:20:18</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/May_2020/017849_BIP-341-Committing-to-all-scriptPubKeys-in-the-signature-message.xml.html">BIP-341: Committing to all scriptPubKeys in the signature message</a>
                        <b>Pieter Wuille 2020-05-11 22:12:33</b>
                    </li>
                
            
        </ul>
        
            <a href="https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2020-May/017807.html">Click here to read the original discussion on the bitcoin-dev mailing list</a>
        
        <p><i>Published on: 2020-05-01T08:48:41+00:00</i></p>
        <hr>
        <h3>Summary:</h3>
        <p>In an email thread discussing the bitcoin-dev mailing list, Andrew Kozlik proposed an amendment to BIP-341 that would require the signature message to commit to the scriptPubKeys of all transaction inputs instead of just the output being spent. This change is important in applications like CoinJoin where wallets have to deal with transactions containing external inputs and need to reliably determine for each input whether it belongs to the wallet or not. Without such a mechanism, an adversary can fool the wallet into displaying incorrect information about the amount being spent, which can result in theft of user funds.The proposed solution would require the signature message to include sha_scriptPubKeys, which is the SHA256 of the serialization of all scriptPubKeys of the previous outputs spent by the transaction. The proposal has already been discussed as a lightweight way of informing offline signers if inputs were segwit or not for malleability analysis reasons. Additionally, Russell O'Connor has included similar functionality in his design for Simplicity on Elements and has been leaning towards adding this kind of functionality in his Bitcoin demo application.However, not everyone agrees with the proposal, as it could limit one's ability to track where funds went. In cases where only some of the output destinations matter, all output ScriptPubKeys would still need to be examined. To address this concern, Pieter Wuille, a Bitcoin Core developer, has proposed a change to the existing BIP341 and BIP342 that would require signatures to commit to every spent scriptPubKey and element of TxOut instead of just the amount. This change would improve the ability of signers to determine whether they can safely sign with only O(1) information per input.Anthony Towns raised concerns about missing information in Bitcoin transactions, noting that the height of a coin and whether it is a Coinbase output are not currently covered by any signature mode. While committing to the coinbase flag might have some use, adding the height of the coin would make it hard to chain unconfirmed spends. In addition, there have been discussions about how to ascertain non-ownership of an external input by obtaining the scriptPubKey of the previous output spent by the input. While it is easy to check whether a scriptPubKey contains a specific pubkey using P2PK/P2TR, it is impractical for wallets to check whether a scriptPubKey contains any of the possible two billion keys in a specific BIP32 derivation path, particularly since many wallets support multiple paths.In response to Andrew's proposal, Jeremy Rubin suggested using SIGHASH_ALL to sign the COutPoints of all inputs which commit to the scriptPubKeys of the txn, eliminating the need for the metadata protocol. However, Andrew explained that his proposal is about avoiding the need for the metadata protocol altogether, as it has been a design goal in both BIP-143 and BIP-341.Russell O'Connor also proposed separating the hashing of the output values from the output ScriptPubKeys in sha_outputs so that applications interested only in summing the values of the outputs (for instance to compute fees) do not have to wade through those arbitrary long ScriptPubKeys in the outputs. However, if one did not verify the output scriptPubKeys, they would only be able to care about fees since they couldn't verify where any of the funds went.Overall, these proposals aim to provide a more reliable way to determine ownership of external inputs and improve security. The downsides of each proposal are being carefully considered, and additional review is required before any changes are implemented.</p>
        <hr>
        <p><i>Updated on: 2023-06-14T01:08:55.821487+00:00</i></p>
    

    

    <footer>
        <span style="font-family: Arial, Helvetica, sans-serif;">&#10084;&#65039;</span> <a href="https://chaincode.com" target="_blank" rel="noreferrer" style="text-decoration: none; color: inherit;">Chaincode</a>
    </footer>
</body>

</html>