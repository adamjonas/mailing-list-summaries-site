<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=us-ascii">
    <title>Atom Feed Display</title>
    <link rel="stylesheet" href="../../archive_styles.css">
</head>

<body BGCOLOR="#fffffb">
    
    <h1>Speeding up &#34;getbalance &lt;account&gt;&#34; calls <span class="combined-summary">[combined summary]</span></h1>
    <hr class="solid">
    <br><b>Individual post summaries:</b>
    
        <ul>
            
                
                    <li>
                        <a href="/bitcoin-dev/June_2011/000063_Speeding-up-getbalance-account-calls.xml.html">Speeding up &#34;getbalance &lt;account&gt;&#34; calls</a>
                        <b>John Smith 2011-06-24 05:30:54</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/June_2011/000062_Speeding-up-getbalance-account-calls.xml.html">Speeding up &#34;getbalance &lt;account&gt;&#34; calls</a>
                        <b>jan at uos.de 2011-06-23 21:51:43</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/July_2011/000128_Speeding-up-getbalance-account-calls.xml.html">Speeding up &#34;getbalance &lt;account&gt;&#34; calls</a>
                        <b>jan at uos.de 2011-07-04 11:40:28</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/July_2011/000127_Speeding-up-getbalance-account-calls.xml.html">Speeding up &#34;getbalance &lt;account&gt;&#34; calls</a>
                        <b>Jan Vornberger 2011-07-03 16:29:05</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/July_2011/000128_Speeding-up-getbalance-account-calls.xml.html">Speeding up &#34;getbalance &lt;account&gt;&#34; calls</a>
                        <b>jan at uos.de 2011-07-04 11:40:28</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/June_2011/000063_Speeding-up-getbalance-account-calls.xml.html">Speeding up &#34;getbalance &lt;account&gt;&#34; calls</a>
                        <b>John Smith 2011-06-24 05:30:54</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/July_2011/000127_Speeding-up-getbalance-account-calls.xml.html">Speeding up &#34;getbalance &lt;account&gt;&#34; calls</a>
                        <b>Jan Vornberger 2011-07-03 16:29:05</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/July_2011/000128_Speeding-up-getbalance-account-calls.xml.html">Speeding up &#34;getbalance &lt;account&gt;&#34; calls</a>
                        <b>jan at uos.de 2011-07-04 11:40:28</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/July_2011/000127_Speeding-up-getbalance-account-calls.xml.html">Speeding up &#34;getbalance &lt;account&gt;&#34; calls</a>
                        <b>Jan Vornberger 2011-07-03 16:29:05</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/June_2011/000062_Speeding-up-getbalance-account-calls.xml.html">Speeding up &#34;getbalance &lt;account&gt;&#34; calls</a>
                        <b>jan at uos.de 2011-06-23 21:51:43</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/June_2011/000062_Speeding-up-getbalance-account-calls.xml.html">Speeding up &#34;getbalance &lt;account&gt;&#34; calls</a>
                        <b>jan at uos.de 2011-06-23 21:51:43</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/June_2011/000063_Speeding-up-getbalance-account-calls.xml.html">Speeding up &#34;getbalance &lt;account&gt;&#34; calls</a>
                        <b>John Smith 2011-06-24 05:30:54</b>
                    </li>
                
            
        </ul>
        
            <a href="https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2011-June/000063.html">Click here to read the original discussion on the bitcoin-dev mailing list</a>
        
        <p><i>Published on: 2011-06-24T05:30:54+00:00</i></p>
        <hr>
        <h3>Summary:</h3>
        <p>Jan Vornberger, the founder of Instawallet, faced a bottleneck problem with "getbalance" taking too much time to complete as bitcoind runs through all transactions each time anew to compute the balance. He sought advice on how to improve this issue and posted on the Bitcoin mailing list in 2011. John Smith suggested scanning the wallet every time a block comes in or something else changes in the blockchain, which could be done in amortized linear time using a hash_map to reduce the API's response time.Jan implemented this suggestion and created a list of all account balances every time a new block came in or a transaction affecting his wallet appeared. The list was stored in a map, and it worked well. However, there were issues with “sendfrom” triggering a rebuild of the cache and not returning before the rebuild was complete. To solve this, Jan changed the approach slightly, and a complete rebuild of the cache only happened on new blocks, whereas, on new wallet transactions, the cache was adjusted incrementally.Jan shared his code on a Github branch for anyone who might need this solution. However, the cache wouldn't work correctly with the RPC command "move" as he hadn't implemented the necessary adjustments. Another suggestion to improve the speed of bitcoind in computing the balance for relevant transactions is to scan the wallet every time a block comes in or changes in the blockchain and accumulate balances for all accounts using a hash_map in amortized linear time. This approach reduces the API response time to a predictable, short time and reduces the risk of bugs compared to incremental caching. It also handles block chain reorganizations without issue.</p>
        <hr>
        <p><i>Updated on: 2023-05-26T18:31:39.806005+00:00</i></p>
    

    

    <footer>
        <span style="font-family: Arial, Helvetica, sans-serif;">&#10084;&#65039;</span> <a href="https://chaincode.com" target="_blank" rel="noreferrer" style="text-decoration: none; color: inherit;">Chaincode</a>
    </footer>
</body>

</html>