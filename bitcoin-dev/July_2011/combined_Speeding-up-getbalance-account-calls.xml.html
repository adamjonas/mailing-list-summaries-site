<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=us-ascii">
    <title>Atom Feed Display</title>
    <link rel="stylesheet" href="../../archive_styles.css">
</head>

<body BGCOLOR="#fffffb">
    
    <h1>Speeding up &#34;getbalance &lt;account&gt;&#34; calls <span class="combined-summary">[combined summary]</span></h1>
    <hr class="solid">
    <br><b>Individual post summaries:</b>
    
        <ul>
            
                
                    <li>
                        <a href="/bitcoin-dev/June_2011/000063_Speeding-up-getbalance-account-calls.xml.html">Speeding up &#34;getbalance &lt;account&gt;&#34; calls</a>
                        <b>John Smith 2011-06-24 05:30:54</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/June_2011/000062_Speeding-up-getbalance-account-calls.xml.html">Speeding up &#34;getbalance &lt;account&gt;&#34; calls</a>
                        <b>jan at uos.de 2011-06-23 21:51:43</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/July_2011/000128_Speeding-up-getbalance-account-calls.xml.html">Speeding up &#34;getbalance &lt;account&gt;&#34; calls</a>
                        <b>jan at uos.de 2011-07-04 11:40:28</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/July_2011/000127_Speeding-up-getbalance-account-calls.xml.html">Speeding up &#34;getbalance &lt;account&gt;&#34; calls</a>
                        <b>Jan Vornberger 2011-07-03 16:29:05</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/July_2011/000128_Speeding-up-getbalance-account-calls.xml.html">Speeding up &#34;getbalance &lt;account&gt;&#34; calls</a>
                        <b>jan at uos.de 2011-07-04 11:40:28</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/June_2011/000063_Speeding-up-getbalance-account-calls.xml.html">Speeding up &#34;getbalance &lt;account&gt;&#34; calls</a>
                        <b>John Smith 2011-06-24 05:30:54</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/July_2011/000127_Speeding-up-getbalance-account-calls.xml.html">Speeding up &#34;getbalance &lt;account&gt;&#34; calls</a>
                        <b>Jan Vornberger 2011-07-03 16:29:05</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/July_2011/000128_Speeding-up-getbalance-account-calls.xml.html">Speeding up &#34;getbalance &lt;account&gt;&#34; calls</a>
                        <b>jan at uos.de 2011-07-04 11:40:28</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/July_2011/000127_Speeding-up-getbalance-account-calls.xml.html">Speeding up &#34;getbalance &lt;account&gt;&#34; calls</a>
                        <b>Jan Vornberger 2011-07-03 16:29:05</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/June_2011/000062_Speeding-up-getbalance-account-calls.xml.html">Speeding up &#34;getbalance &lt;account&gt;&#34; calls</a>
                        <b>jan at uos.de 2011-06-23 21:51:43</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/June_2011/000062_Speeding-up-getbalance-account-calls.xml.html">Speeding up &#34;getbalance &lt;account&gt;&#34; calls</a>
                        <b>jan at uos.de 2011-06-23 21:51:43</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/June_2011/000063_Speeding-up-getbalance-account-calls.xml.html">Speeding up &#34;getbalance &lt;account&gt;&#34; calls</a>
                        <b>John Smith 2011-06-24 05:30:54</b>
                    </li>
                
            
        </ul>
        
            <a href="https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2011-June/000063.html">Click here to read the original discussion on the bitcoin-dev mailing list</a>
        
        <p><i>Published on: 2011-06-24T05:30:54+00:00</i></p>
        <hr>
        <h3>Summary:</h3>
        <p>Jan Vornberger, the developer of Instawallet, faced a bottleneck issue with the 'getbalance' API taking too long to complete. He discovered that bitcoind ran through all relevant transactions each time anew to compute the balance. Jan considered implementing a caching system in bitcoind to cache calls to getbalance and invalidate the cache when new blocks or transactions that affect the wallet arrive. However, he was unsure whether a more sophisticated cache that only invalidated affected entries would be necessary to handle block chain reorgs. To address the issue, John Smith suggested scanning the wallet every time there is a change in the blockchain using a hash_map to accumulate balances for all accounts. This approach would reduce the time taken to return the balance for an account, make it predictable, and less prone to bugs. It would also handle block chain reorgs without any issues.Jan implemented this suggestion and created a list of all account balances every time a new block comes in or a transaction that affects the wallet appears. The list is stored in a "map" right now. Initially, Jan did not use a hash map because he was new to C++ and was confused about what to use. However, he chose a tree-based implementation of a map due to limited memory on his VPS.When Jan tried to use "sendfrom," it triggered a rebuild of the cache and could not return before the rebuild was complete. To address this, Jan changed the approach slightly so that a complete rebuild of the cache would only happen on new blocks (in case reorgs happen). On new wallet transactions, the cache would just be adjusted incrementally. Jan warned that the cache would not work correctly with the RPC command "move" since he had not implemented the necessary adjustments yet. Overall, implementing the suggested solution improved the efficiency and reliability of the balance computation process.</p>
        <hr>
        <p><i>Updated on: 2023-05-26T18:35:48.645749+00:00</i></p>
    

    

    <footer>
        <span style="font-family: Arial, Helvetica, sans-serif;">&#10084;&#65039;</span> <a href="https://chaincode.com" target="_blank" rel="noreferrer" style="text-decoration: none; color: inherit;">Chaincode</a>
    </footer>
</body>

</html>