<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=us-ascii">
    <title>Atom Feed Display</title>
    <link rel="stylesheet" href="../../archive_styles.css">
</head>

<body BGCOLOR="#fffffb">
    
    <h1>Adding xpub field to PSBT to make multisig more secure <span class="combined-summary">[combined summary]</span></h1>
    <hr class="solid">
    <br><b>Individual post summaries:</b>
    
        <ul>
            
                
                    <li>
                        <a href="/bitcoin-dev/April_2019/016894_Adding-xpub-field-to-PSBT-to-make-multisig-more-secure.html">Adding xpub field to PSBT to make multisig more secure</a>
                        <b>Stepan Snigirev 2019-04-26 15:21:06</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/May_2019/016917_Adding-xpub-field-to-PSBT-to-make-multisig-more-secure.html">Adding xpub field to PSBT to make multisig more secure</a>
                        <b>Dmitry Petukhov 2019-05-07 13:40:34</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/May_2019/016926_Adding-xpub-field-to-PSBT-to-make-multisig-more-secure.html">Adding xpub field to PSBT to make multisig more secure</a>
                        <b>Dmitry Petukhov 2019-05-09 17:08:47</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/April_2019/016894_Adding-xpub-field-to-PSBT-to-make-multisig-more-secure.html">Adding xpub field to PSBT to make multisig more secure</a>
                        <b>Stepan Snigirev 2019-04-26 15:21:06</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/May_2019/016909_Adding-xpub-field-to-PSBT-to-make-multisig-more-secure.html">Adding xpub field to PSBT to make multisig more secure</a>
                        <b>Peter D. Gray 2019-05-03 13:29:45</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/May_2019/016926_Adding-xpub-field-to-PSBT-to-make-multisig-more-secure.html">Adding xpub field to PSBT to make multisig more secure</a>
                        <b>Dmitry Petukhov 2019-05-09 17:08:47</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/May_2019/016916_Adding-xpub-field-to-PSBT-to-make-multisig-more-secure.html">Adding xpub field to PSBT to make multisig more secure</a>
                        <b>Stepan Snigirev 2019-05-07 09:23:44</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/May_2019/016917_Adding-xpub-field-to-PSBT-to-make-multisig-more-secure.html">Adding xpub field to PSBT to make multisig more secure</a>
                        <b>Dmitry Petukhov 2019-05-07 13:40:34</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/April_2019/016894_Adding-xpub-field-to-PSBT-to-make-multisig-more-secure.html">Adding xpub field to PSBT to make multisig more secure</a>
                        <b>Stepan Snigirev 2019-04-26 15:21:06</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/May_2019/016907_Adding-xpub-field-to-PSBT-to-make-multisig-more-secure.html">Adding xpub field to PSBT to make multisig more secure</a>
                        <b>Andrew Chow 2019-05-01 16:57:38</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/May_2019/016909_Adding-xpub-field-to-PSBT-to-make-multisig-more-secure.html">Adding xpub field to PSBT to make multisig more secure</a>
                        <b>Peter D. Gray 2019-05-03 13:29:45</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/May_2019/016925_Adding-xpub-field-to-PSBT-to-make-multisig-more-secure.html">Adding xpub field to PSBT to make multisig more secure</a>
                        <b>jan matejek 2019-05-08 07:54:53</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/May_2019/016926_Adding-xpub-field-to-PSBT-to-make-multisig-more-secure.html">Adding xpub field to PSBT to make multisig more secure</a>
                        <b>Dmitry Petukhov 2019-05-09 17:08:47</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/May_2019/016907_Adding-xpub-field-to-PSBT-to-make-multisig-more-secure.html">Adding xpub field to PSBT to make multisig more secure</a>
                        <b>Andrew Chow 2019-05-01 16:57:38</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/May_2019/016909_Adding-xpub-field-to-PSBT-to-make-multisig-more-secure.html">Adding xpub field to PSBT to make multisig more secure</a>
                        <b>Peter D. Gray 2019-05-03 13:29:45</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/May_2019/016925_Adding-xpub-field-to-PSBT-to-make-multisig-more-secure.html">Adding xpub field to PSBT to make multisig more secure</a>
                        <b>jan matejek 2019-05-08 07:54:53</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/May_2019/016907_Adding-xpub-field-to-PSBT-to-make-multisig-more-secure.html">Adding xpub field to PSBT to make multisig more secure</a>
                        <b>Andrew Chow 2019-05-01 16:57:38</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/May_2019/016916_Adding-xpub-field-to-PSBT-to-make-multisig-more-secure.html">Adding xpub field to PSBT to make multisig more secure</a>
                        <b>Stepan Snigirev 2019-05-07 09:23:44</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/May_2019/016925_Adding-xpub-field-to-PSBT-to-make-multisig-more-secure.html">Adding xpub field to PSBT to make multisig more secure</a>
                        <b>jan matejek 2019-05-08 07:54:53</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/May_2019/016916_Adding-xpub-field-to-PSBT-to-make-multisig-more-secure.html">Adding xpub field to PSBT to make multisig more secure</a>
                        <b>Stepan Snigirev 2019-05-07 09:23:44</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/May_2019/016917_Adding-xpub-field-to-PSBT-to-make-multisig-more-secure.html">Adding xpub field to PSBT to make multisig more secure</a>
                        <b>Dmitry Petukhov 2019-05-07 13:40:34</b>
                    </li>
                
            
        </ul>
        
            <a href="https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2019-April/016894.html">Click here to read the original discussion on the bitcoin-dev mailing list</a>
        
        <p><i>Published on: 2019-04-26T15:21:06+00:00</i></p>
        <hr>
        <h3>Summary:</h3>
        <p>Stepan Snigirev has proposed a solution to prevent theft of user funds in multisignature setups. He raised concerns about the possibility of an attacker replacing half of the keys in the change address with their own keys and still getting the transaction signed, resulting in the loss of user funds. Snigirev suggested adding an xpub field to the inputs and outputs metadata in partially signed bitcoin transactions (PSBT) to verify that the same xpubs are used for public keys in inputs and outputs, ensuring that the output is indeed a change. He proposed two new key-value pairs to be added to PSBT: `PSBT_IN_BIP32_XPUB` and `PSBT_OUT_BIP32_XPUB`. The proposal suggests sharing xpubs in the global section of the file, with a restriction that they must only include the hardened prefix of the path.Dmitry Petukhov suggested that a hardware wallet can sign a message consisting of xpubs of participants and auxiliary text during the setup phase. However, the thread discusses the threat model and suggests that each individual multisig signature signs the set of signers. Therefore, if an attacker provides bad xpubs, the signature won't be valid for the given multisig output. The input==output check is sufficient to ensure that the change goes to the same multisig wallet. To solve the problem of showing incoming addresses to the user while keeping hardware wallets stateless, the proposal suggests verifying that xpubs in the inputs and in the change output are the same during the setup phase. As PSBT is a binary format, using the extension serialization format without any encodings makes sense. Keeping the prefix that defines if the key is used for testnet or mainnet may also be useful.In order to safely show an incoming address to the user, PSBT-signing devices still need to store the xpubs of their co-signers. This represents data that should not change between PSBT instances. The proposal suggests constructing an auxiliary text with a code word marking 'epoch' of the package, which will be displayed prominently. In case of compromise, new trusted-xpub packages would use a different 'epoch' code word.Hardware wallets can sign a message consisting of xpubs of participants and auxiliary text during the setup phase using the key derived from the master key, with the path chosen specifically for this purpose. The software stores the message and signature and sends a 'trusted-xpub-package' to the hardware wallet along with the transaction. The hardware wallet can then mark outputs that use the pubkeys derived from 'verified' xpubs as 'trusted' outputs. It can also display the auxiliary text along with information about the 'trusted' output.This way, hardware wallet does not need to store anything extra besides the master key. This allows distinguishing trusted output even if the inputs are not all derived from the same set of xpubs. If the user loses the signature for the 'trusted-xpub-package', it can be re-created again but the procedure should be more involved than ordinary signing since creating such a package with malicious keys could enable attackers to bypass these checks. Peter D. Gray, founder of Coinkite, also added to the discussion, suggesting that PSBT-signing devices should store the xpubs of their co-signers to safely show an incoming address to the user without a full understanding of the other keys in a "multisig wallet". The proposal suggests adding `PSBT_IN_BIP32_XPUB` and `PSBT_OUT_BIP32_XPUB` key-value pairs to PSBT, containing a derivation path for an xpub and a 78-byte xpub value respectively. Snigirev also suggested reviewing the communication protocols of existing hardware and multisignature wallets to see if there are other solutions to this issue.</p>
        <hr>
        <p><i>Updated on: 2023-06-13T18:27:07.651725+00:00</i></p>
    

    

    <footer>
        <span style="font-family: Arial, Helvetica, sans-serif;">&#10084;&#65039;</span> <a href="https://chaincode.com" target="_blank" rel="noreferrer" style="text-decoration: none; color: inherit;">Chaincode</a>
    </footer>
</body>

</html>