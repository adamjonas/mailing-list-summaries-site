<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=us-ascii">
    <title>Atom Feed Display</title>
    <link rel="stylesheet" href="../../archive_styles.css">
</head>

<body BGCOLOR="#fffffb">
    
    <h1>Concrete MATT opcodes <span class="combined-summary">[combined summary]</span></h1>
    <hr class="solid">
    <br><b>Individual post summaries:</b>
    
        <ul>
            
                
                    <li>
                        <a href="/bitcoin-dev/Aug_2023/021856_Concrete-MATT-opcodes.html">Concrete MATT opcodes</a>
                        <b>David A. Harding 2023-08-06 20:13:25+00:00</b>
                    </li>
                
                    <li>
                        <a href="/bitcoin-dev/July_2023/021827_Concrete-MATT-opcodes.html">Concrete MATT opcodes</a>
                        <b>Salvatore Ingala 2023-07-30 21:37:49+00:00</b>
                    </li>
                
            
        </ul>
        
            <a href="https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2023-August/021856.html">Click here to read the original discussion on the bitcoin-dev mailing list</a>
        
        <p><i>Published on: 2023-08-06T20:13:25+00:00</i></p>
        <hr>
        <h3>Summary:</h3>
        <p>Salvatore Ingala has presented a complete proposal for the core opcodes of MATT, which includes the implementation of OP_CHECKCONTRACTVERIFY. The proposal can be found in the bitcoin-inquisition repo fork. The diff in the repo provides detailed information about the implementation and includes basic functional tests. The main changes in this proposal compared to the previous draft include replacing OP_CHECK{IN, OUT}CONTRACTVERIFY with a single opcode, OP_CHECKCONTRACTVERIFY (CCV). Additionally, an additional `flags` parameter is introduced to specify whether the opcode operates on an input or an output. The default behavior for outputs includes a deferred checks mechanism for amounts, where the input amounts with CCV towards the same output are summed and act as a lower bound for that output's amount. However, this behavior can be disabled with a flag.The order of parameters is also modified for better script writing. The new OP_CHECKCONTRACTVERIFY takes five parameters from the stack and checks if the -th input/output's scriptPubKey is a P2TR with a public key obtained from optionally tweaked wit and optionally tap-tweaked with. Special values are defined for the parameters, such as using a fixed NUMS point if  is empty, using the current input's taproot internal key if  is -1, and using the current input's index if  is -1. There are also defined flags, including CCV_FLAG_CHECK_INPUT and CCV_FLAG_IGNORE_OUTPUT_AMOUNT. After evaluating all inputs, it is verified that each output's amount is greater than or equal to the total amount in the bucket of that output, validating the deferred checks. The author notes that while some special values may not be useful in applications, they were included for flexibility.With the introduction of the new opcode, the full generality of MATT can be achieved with just two opcodes: OP_CHECKCONTRACTVERIFY and OP_CAT. However, the author acknowledges that additional opcodes and introspection may benefit certain applications.</p>
        <hr>
        <p><i>Updated on: 2023-08-07T22:28:28.877817+00:00</i></p>
    

    

    <footer>
        <span style="font-family: Arial, Helvetica, sans-serif;">&#10084;&#65039;</span> <a href="https://chaincode.com" target="_blank" rel="noreferrer" style="text-decoration: none; color: inherit;">Chaincode</a>
    </footer>
</body>

</html>